/*! For license information please see editor.bundle.js.LICENSE.txt */
(()=>{"use strict";var e={38(e,t,n){n.d(t,{A:()=>s});var r=n(601),i=n.n(r),o=n(314),a=n.n(o)()(i());a.push([e.id,".plintus-properties-panel {\n    width: 300px;\n    height: 100%;\n    background: #fff;\n    border-left: 1px solid #ddd;\n    display: flex;\n    flex-direction: column;\n    overflow-y: auto;\n    flex-shrink: 0; /* Prevent panel from shrinking */\n}\n\n.panel-header {\n    padding: 15px;\n    border-bottom: 1px solid #ddd;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.panel-header h3 {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n}\n\n.delete-button {\n    padding: 6px 12px;\n    background: #dc3545;\n    color: #fff;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n}\n\n.delete-button:hover {\n    background: #c82333;\n}\n\n.panel-content {\n    padding: 15px;\n    flex: 1;\n}\n\n.properties-elements-list {\n    margin-bottom: 20px;\n}\n\n.properties-elements-list h4 {\n    margin: 0 0 10px 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: #555;\n}\n\n.properties-elements-list-items {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n}\n\n.properties-element-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px;\n    margin-bottom: 4px;\n    background: #f5f5f5;\n    border-radius: 4px;\n    font-size: 13px;\n}\n\n.element-type-badge {\n    background: #0073aa;\n    color: #fff;\n    padding: 2px 6px;\n    border-radius: 3px;\n    font-size: 11px;\n    font-weight: 600;\n    text-transform: uppercase;\n}\n\n.element-id {\n    color: #666;\n    font-weight: 500;\n}\n\n.element-length {\n    margin-left: auto;\n    color: #333;\n    font-weight: 600;\n}\n\n.arc-properties,\n.line-properties,\n.fillet-properties {\n    margin-top: 20px;\n    padding: 15px;\n    background: #f9f9f9;\n    border-radius: 4px;\n    border: 1px solid #e0e0e0;\n}\n\n.arc-properties h4,\n.line-properties h4,\n.fillet-properties h4 {\n    margin: 0 0 15px 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: #333;\n}\n\n.property-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n    padding: 8px 0;\n    border-bottom: 1px solid #e0e0e0;\n}\n\n.property-item:last-child {\n    border-bottom: none;\n    margin-bottom: 0;\n}\n\n.property-item label {\n    font-size: 13px;\n    color: #666;\n    font-weight: 500;\n}\n\n.property-value {\n    font-size: 13px;\n    color: #333;\n    font-weight: 600;\n}\n\n.property-input {\n    width: 80px;\n    padding: 4px 8px;\n    border: 1px solid #ccc;\n    border-radius: 3px;\n    font-size: 13px;\n    text-align: right;\n}\n\n.property-input:focus {\n    outline: none;\n    border-color: #0073aa;\n    box-shadow: 0 0 0 2px rgba(0, 115, 170, 0.1);\n}\n\n.properties-empty-state {\n    color: #999;\n    font-size: 13px;\n    font-style: italic;\n    margin: 10px 0;\n    padding: 10px;\n    text-align: center;\n}\n\n.properties-summary {\n    margin-bottom: 20px;\n    padding: 15px;\n    background: #f9f9f9;\n    border-radius: 4px;\n    border: 1px solid #e0e0e0;\n}\n\n.properties-summary h4 {\n    margin: 0 0 15px 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: #333;\n}\n\n.properties-section {\n    margin-top: 20px;\n    margin-bottom: 15px;\n}\n\n.properties-section-title {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: #333;\n}\n\n.summary-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n    padding: 8px 0;\n    border-bottom: 1px solid #e0e0e0;\n}\n\n.summary-item:last-child {\n    border-bottom: none;\n    margin-bottom: 0;\n}\n\n.summary-label {\n    font-size: 13px;\n    color: #666;\n    font-weight: 500;\n}\n\n.summary-value {\n    font-size: 13px;\n    color: #333;\n    font-weight: 600;\n}\n\n\n\n\n",""]);const s=a},47(e,t,n){n.d(t,{A:()=>s});var r=n(601),i=n.n(r),o=n(314),a=n.n(o)()(i());a.push([e.id,".plintus-vertical-toolbar {\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n    padding: 10px;\n    background: #fff;\n    border-right: 1px solid #ddd;\n    width: 120px;\n    gap: 5px;\n}\n\n.plintus-vertical-tool-button {\n    width: 100%;\n    min-height: 50px;\n    border: 1px solid #ddd;\n    background: #fff;\n    cursor: pointer;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 8px 5px;\n    margin: 0;\n    transition: all 0.2s;\n    gap: 4px;\n}\n\n.plintus-vertical-tool-button:hover {\n    background: #f0f0f0;\n    border-color: #0073aa;\n}\n\n.plintus-vertical-tool-button.active {\n    background: #0073aa;\n    color: #fff;\n    border-color: #0073aa;\n}\n\n.plintus-vertical-tool-button-text {\n    font-size: 12px;\n    line-height: 1.2;\n    text-align: center;\n    white-space: nowrap;\n}\n\n.plintus-vertical-tool-button i {\n    font-size: 24px;\n}\n\n\n\n",""]);const s=a},52(e,t,n){n.d(t,{A:()=>s});var r=n(601),i=n.n(r),o=n(314),a=n.n(o)()(i());a.push([e.id,".canvas-editor {\n    width: 100%;\n    height: 100%;\n    position: relative;\n    overflow: hidden;\n}\n\n#plintus-paperjs-canvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n    /* Размеры устанавливаются через атрибуты width и height, не через CSS */\n}\n\n",""]);const s=a},56(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72(e){var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},a=[],s=0;s<e.length;s++){var l=e[s],c=r.base?l[0]+r.base:l[0],d=o[c]||0,u="".concat(c," ").concat(d);o[c]=d+1;var f=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)t[f].references++,t[f].updater(p);else{var h=i(p,r);r.byIndex=s,t.splice(s,0,{identifier:u,updater:h,references:1})}a.push(u)}return a}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var o=r(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var s=n(o[a]);t[s].references--}for(var l=r(e,i),c=0;c<o.length;c++){var d=n(o[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=l}}},113(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},162(e,t,n){var r=n(594),i=n(888),o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=i.useSyncExternalStore,s=r.useRef,l=r.useEffect,c=r.useMemo,d=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var u=s(null);if(null===u.current){var f={hasValue:!1,value:null};u.current=f}else f=u.current;u=c(function(){function e(e){if(!l){if(l=!0,a=e,e=r(e),void 0!==i&&f.hasValue){var t=f.value;if(i(t,e))return s=t}return s=e}if(t=s,o(a,e))return t;var n=r(e);return void 0!==i&&i(t,n)?(a=e,t):(a=e,s=n)}var a,s,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,r,i]);var p=a(e,u[0],u[1]);return l(function(){f.hasValue=!0,f.value=p},[p]),d(p),p}},206(e){e.exports=ReactDOM},242(e,t,n){e.exports=n(162)},314(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,r,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);r&&a[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},338(e,t,n){var r=n(206);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},493(e,t,n){var r=n(594),i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=r.useState,a=r.useEffect,s=r.useLayoutEffect,l=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!i(e,n)}catch(e){return!0}}var d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=o({inst:{value:n,getSnapshot:t}}),i=r[0].inst,d=r[1];return s(function(){i.value=n,i.getSnapshot=t,c(i)&&d({inst:i})},[e,n,t]),a(function(){return c(i)&&d({inst:i}),e(function(){c(i)&&d({inst:i})})},[e]),l(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:d},540(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},594(e){e.exports=React},601(e){e.exports=function(e){return e[1]}},659(e){var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},825(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},888(e,t,n){e.exports=n(493)},912(e,t,n){n.d(t,{A:()=>s});var r=n(601),i=n.n(r),o=n(314),a=n.n(o)()(i());a.push([e.id,".plintus-editor {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    background: #f5f5f5;\n}\n\n.plintus-editor-content {\n    flex: 1;\n    position: relative;\n    overflow: hidden;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: row;\n}\n\n.plintus-editor-canvas-wrapper {\n    flex: 1;\n    height: 100%;\n    position: relative;\n    min-width: 0; /* Allows flex item to shrink below its content size */\n}\n\n\n\n\n",""]);const s=a},925(e,t,n){n.d(t,{A:()=>s});var r=n(601),i=n.n(r),o=n(314),a=n.n(o)()(i());a.push([e.id,".plintus-toolbar {\n    display: flex;\n    align-items: center;\n    padding: 10px;\n    background: #fff;\n    border-bottom: 1px solid #ddd;\n    justify-content: space-between;\n}\n\n.plintus-toolbar-section {\n    display: flex;\n    gap: 0;\n    align-items: center;\n}\n\n.plintus-toolbar-section-right {\n    margin-left: auto;\n}\n\n.plintus-tool-button {\n    width: 36px;\n    height: 36px;\n    border: 1px solid #ddd;\n    background: #fff;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 0;\n    margin: 0;\n    transition: all 0.2s;\n}\n\n.plintus-tool-button:hover {\n    background: #f0f0f0;\n    border-color: #0073aa;\n}\n\n.plintus-tool-button.active {\n    background: #0073aa;\n    color: #fff;\n    border-color: #0073aa;\n}\n\n.plintus-toolbar button {\n    width: 36px;\n    height: 36px;\n    border: 1px solid #ddd;\n    background: #fff;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 0;\n    margin: 0;\n    transition: all 0.2s;\n}\n\n.plintus-toolbar button:hover {\n    background: #f0f0f0;\n    border-color: #0073aa;\n}\n\n.plintus-toolbar button.active {\n    background: #0073aa;\n    color: #fff;\n    border-color: #0073aa;\n}\n\n.plintus-toolbar button i {\n    font-size: 18px;\n}\n\n\n\n\n\n\n",""]);const s=a}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var r=n(594),i=n.n(r),o=n(338);const a=e=>{let t;const n=new Set,r=(e,r)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,o={setState:r,getState:i,getInitialState:()=>a,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{"production"!=={NODE_ENV:"production"}.MODE&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},a=t=e(r,i,o);return o};var s=n(242);const{useDebugValue:l}=r,{useSyncExternalStoreWithSelector:c}=s;let d=!1;const u=e=>e,f=e=>{"production"!=={NODE_ENV:"production"}.MODE&&"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?(e=>e?a(e):a)(e):e,n=(e,n)=>function(e,t=u,n){"production"!=={NODE_ENV:"production"}.MODE&&n&&!d&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),d=!0);const r=c(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return l(r),r}(t,e,n);return Object.assign(n,t),n};function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){y(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function y(e,t,n){return(t=function(e){var t=function(e){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function g(e){return 3.779527559*e}function b(e){return e/3.779527559}function x(e){var t=b(e);return"".concat(Math.round(10*t)/10," мм")}function E(e,t){return Math.round(e/t)*t}function w(e,t){return{x:E(e.x,t),y:E(e.y,t)}}function S(e,t){return Math.abs(t.x-e.x)>Math.abs(t.y-e.y)?{x:t.x,y:e.y}:{x:e.x,y:t.y}}function P(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,i=n.x-t.x,o=n.y-t.y,a=Math.sqrt(i*i+o*o);if(0===a)return!1;var s=Math.max(0,Math.min(1,((e.x-t.x)*i+(e.y-t.y)*o)/(a*a))),l=t.x+s*i,c=t.y+s*o;return Math.sqrt(Math.pow(e.x-l,2)+Math.pow(e.y-c,2))<r}function C(e){var t=e.end.x-e.start.x,n=e.end.y-e.start.y,r=Math.sqrt(t*t+n*n);return 0===r?{x:0,y:0}:{x:t/r,y:n/r}}function I(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=[{point:e.start,line1End:!0,line2End:!1},{point:e.end,line1End:!0,line2End:!1},{point:t.start,line1End:!1,line2End:!0},{point:t.end,line1End:!1,line2End:!0}],i=0;i<r.length;i++)for(var o=i+1;o<r.length;o++)if(v(r[i].point,r[o].point)<n)return m(m({},r[i].point),{},{line1End:r[i].line1End||r[o].line1End,line2End:r[i].line2End||r[o].line2End});return null}function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach(function(t){O(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function O(e,t,n){return(t=function(e){var t=function(e){if("object"!=T(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=T(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==T(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return A(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var D,N=(D=function(e,t){return{elements:[],selectedElements:[],selectedTool:"line",grid:{stepMM:1,snap:!0,visible:!0,showMajorLines:!1},dimensionsVisible:!0,debugNumbersVisible:!1,orthogonalSnap:!0,viewbox:{x:0,y:0,width:800,height:400},isDrawing:!1,currentLineStart:null,zoom:2,setSelectedTool:function(t){return e({selectedTool:t,selectedElements:[]})},addElement:function(t){return e(function(e){return{elements:[].concat(k(e.elements),[M(M({},t),{},{id:"element-".concat(Date.now(),"-").concat(Math.random())})])}})},updateElement:function(t,n){return e(function(e){return{elements:e.elements.map(function(e){return e.id===t?M(M({},e),n):e})}})},deleteElement:function(t){return e(function(e){var n=e.elements.find(function(e){return e.id===t});if(n&&"fillet"===n.type&&n.connection){var r=n.line1Id,i=n.line2Id,o=n.connection,a=n.line1EndTruncated,s=n.line2EndTruncated;fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:36",message:"deleteElement fillet detected",data:{filletId:t,line1Id:r,line2Id:i,connection:o,line1EndTruncated:a,line2EndTruncated:s},timestamp:Date.now(),sessionId:"debug-session",runId:"delete-fillet",hypothesisId:"A"})}).catch(function(){});var l=e.elements.find(function(e){return e.id===r&&"line"===e.type}),c=e.elements.find(function(e){return e.id===i&&"line"===e.type});fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:50",message:"deleteElement lines found",data:{line1Found:!!l,line2Found:!!c,line1:l?{start:l.start,end:l.end}:null,line2:c?{start:c.start,end:c.end}:null},timestamp:Date.now(),sessionId:"debug-session",runId:"delete-fillet",hypothesisId:"A"})}).catch(function(){});var d=a,u=s;if(void 0===d&&l){var f=v(o,l.start),p=v(o,l.end);d=p<f}if(void 0===u&&c){var h=v(o,c.start),m=v(o,c.end);u=m<h}return fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:70",message:"deleteElement restoration logic",data:{shouldRestoreLine1End:d,shouldRestoreLine2End:u,connection:o},timestamp:Date.now(),sessionId:"debug-session",runId:"delete-fillet",hypothesisId:"A"})}).catch(function(){}),{elements:e.elements.map(function(e){if(e.id===r&&"line"===e.type){var t=M(M({},e),{},d?{end:o}:{start:o});return fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:85",message:"deleteElement line1 restored",data:{line1Id:r,before:{start:e.start,end:e.end},after:{start:t.start,end:t.end},shouldRestoreLine1End:d},timestamp:Date.now(),sessionId:"debug-session",runId:"delete-fillet",hypothesisId:"A"})}).catch(function(){}),t}if(e.id===i&&"line"===e.type){var n=M(M({},e),{},u?{end:o}:{start:o});return fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:95",message:"deleteElement line2 restored",data:{line2Id:i,before:{start:e.start,end:e.end},after:{start:n.start,end:n.end},shouldRestoreLine2End:u},timestamp:Date.now(),sessionId:"debug-session",runId:"delete-fillet",hypothesisId:"A"})}).catch(function(){}),n}return e}).filter(function(e){return e.id!==t}),selectedElements:e.selectedElements.filter(function(e){return e.id!==t})}}return{elements:e.elements.filter(function(e){return e.id!==t}),selectedElements:e.selectedElements.filter(function(e){return e.id!==t})}})},deleteSelectedElements:function(){return e(function(e){var t=new Set(e.selectedElements.map(function(e){return e.id})),n=e.selectedElements.filter(function(e){return"fillet"===e.type}),r=k(e.elements);return n.forEach(function(e){if(e.connection){var t=e.line1Id,n=e.line2Id,i=e.connection,o=e.line1EndTruncated,a=e.line2EndTruncated,s=r.find(function(e){return e.id===t&&"line"===e.type}),l=r.find(function(e){return e.id===n&&"line"===e.type}),c=o,d=a;if(void 0===c&&s){var u=v(i,s.start),f=v(i,s.end);c=f<u}if(void 0===d&&l){var p=v(i,l.start),h=v(i,l.end);d=h<p}r=r.map(function(e){return e.id===t&&"line"===e.type?M(M({},e),{},c?{end:i}:{start:i}):e.id===n&&"line"===e.type?M(M({},e),{},d?{end:i}:{start:i}):e})}}),{elements:r.filter(function(e){return!t.has(e.id)}),selectedElements:[]}})},selectElement:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e(function(e){return t?n?e.selectedElements.some(function(e){return e.id===t.id})?{selectedElements:e.selectedElements.filter(function(e){return e.id!==t.id})}:{selectedElements:[].concat(k(e.selectedElements),[t])}:{selectedElements:[t]}:{selectedElements:[]}})},loadProfile:function(t){return e({elements:t.elements||[],grid:t.grid||{stepMM:1,snap:!0,visible:!0,showMajorLines:!1},viewbox:t.viewbox||{x:0,y:0,width:800,height:400}})},setCurrentLineStart:function(t){return e({currentLineStart:t})},setIsDrawing:function(t){return e({isDrawing:t})},toggleDimensionsVisible:function(){return e(function(e){return{dimensionsVisible:!e.dimensionsVisible}})},toggleDebugNumbersVisible:function(){return e(function(e){return{debugNumbersVisible:!e.debugNumbersVisible}})},toggleMajorLines:function(){return e(function(e){return{grid:M(M({},e.grid),{},{showMajorLines:!e.grid.showMajorLines})}})},toggleOrthogonalSnap:function(){return e(function(e){return{orthogonalSnap:!e.orthogonalSnap}})},updateFilletRadius:function(t,n){return e(function(e){var r=e.elements.find(function(e){return e.id===t&&"fillet"===e.type});if(!r)return e;var i,o=g(n),a=r.connection,s=r.line1Direction,l=r.line2Direction,c=r.angle1,d=r.angle2,u=r.line1Id,f=r.line2Id,p=r.line1EndTruncated,h=r.line2EndTruncated,m={x:a.x+s.x*o,y:a.y+s.y*o},y={x:a.x+l.x*o,y:a.y+l.y*o},b=s,x=l,E={x:-b.y,y:b.x},w={x:-x.y,y:x.x},S=b.x+x.x,P=b.y+x.y,C=Math.sqrt(S*S+P*P),I=C>1e-4?{x:S/C,y:P/C}:{x:-b.y,y:b.x},T=E.x*I.x+E.y*I.y>0?E:{x:-E.x,y:-E.y},j=w.x*I.x+w.y*I.y>0?w:{x:-w.x,y:-w.y},O=y.x-m.x,k=y.y-m.y,A=T.x*j.y-T.y*j.x;if(Math.abs(A)<1e-4){var D=Math.abs(d-c);D>180&&(D=360-D);var N=D*Math.PI/180,L=N>1e-4?o/Math.sin(N/2):o;i={x:a.x+I.x*L,y:a.y+I.y*L}}else{var z=(O*j.y-k*j.x)/A;i={x:m.x+z*T.x,y:m.y+z*T.y}}var R=Math.atan2(m.y-i.y,m.x-i.x),F=Math.atan2(y.y-i.y,y.x-i.x)-R;F>Math.PI?F-=2*Math.PI:F<-Math.PI&&(F+=2*Math.PI);var J=R*(180/Math.PI);J>180&&(J-=360),J<-180&&(J+=360);var W=Math.abs(F)*(180/Math.PI),V=e.elements.find(function(e){return e.id===u}),B=e.elements.find(function(e){return e.id===f});if(!V||!B)return e;var q=V.length||v(V.start,V.end),Z=B.length||v(B.start,B.end),_=p,U=h;if(fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:127",message:"updateFilletRadius truncation check",data:{line1EndTruncated:p,line2EndTruncated:h,line1:{start:V.start,end:V.end},line2:{start:B.start,end:B.end},connection:a},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"A"})}).catch(function(){}),void 0===_||void 0===U){var G=v(a,V.start),Y=v(a,V.end),X=v(a,B.start),$=v(a,B.end);_=Y<G,U=$<X,fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:138",message:"updateFilletRadius fallback calculation",data:{distToLine1Start:G,distToLine1End:Y,distToLine2Start:X,distToLine2End:$,shouldTruncateLine1End:_,shouldTruncateLine2End:U},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"A"})}).catch(function(){})}return{elements:e.elements.map(function(e){if(e.id===t){var n=M(M({},e),{},{radius:o,arc:{center:i,radius:o,startAngle:J,angle:W},arcStartPoint:m,arcEndPoint:y,line1EndTruncated:_,line2EndTruncated:U});return fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:150",message:"updateFilletRadius fillet update",data:{filletId:t,newRadius:o,arcStartPoint:m,arcEndPoint:y,shouldTruncateLine1End:_,shouldTruncateLine2End:U},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"B"})}).catch(function(){}),n}if(e.id===u){var r=_?{end:m,length:q}:{start:m,length:q};return fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:162",message:"updateFilletRadius line1 update",data:{line1Id:u,update:r,shouldTruncateLine1End:_,arcStartPoint:m,originalLine1Length:q},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"B"})}).catch(function(){}),M(M({},e),r)}if(e.id===f){var a=U?{end:y,length:Z}:{start:y,length:Z};return fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:173",message:"updateFilletRadius line2 update",data:{line2Id:f,update:a,shouldTruncateLine2End:U,arcEndPoint:y,originalLine2Length:Z},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"B"})}).catch(function(){}),M(M({},e),a)}return e})}})},getMinZoom:function(){var e=5/g(t().grid.stepMM);return Math.max(.1,e)},zoomIn:function(){return e(function(e){return{zoom:Math.min(1.2*e.zoom,10)}})},zoomOut:function(){var n=t(),r=g(n.grid.stepMM),i=Math.max(.1,5/r),o=Math.max(n.zoom/1.2,i);return e({zoom:o})},resetZoom:function(){return e({zoom:2})},setZoom:function(n){var r=g(t().grid.stepMM),i=Math.max(.1,5/r);return e({zoom:Math.max(i,Math.min(10,n))})}}})?f(D):f,L=n(72),z=n.n(L),R=n(825),F=n.n(R),J=n(659),W=n.n(J),V=n(56),B=n.n(V),q=n(540),Z=n.n(q),_=n(113),U=n.n(_),G=n(52),Y={};function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach(function(t){K(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function K(e,t,n){return(t=function(e){var t=function(e){if("object"!=X(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=X(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==X(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Q(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=te(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||te(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e,t){if(e){if("string"==typeof e)return ne(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ne(e,t):void 0}}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}Y.styleTagTransform=U(),Y.setAttributes=B(),Y.insert=W().bind(null,"head"),Y.domAPI=F(),Y.insertStyleElement=Z(),z()(G.A,Y),G.A&&G.A.locals&&G.A.locals;const re=function(){var e=(0,r.useRef)(null),t=(0,r.useRef)(null),n=(0,r.useRef)(null),o=ee((0,r.useState)(null),2),a=o[0],s=o[1],l=ee((0,r.useState)({width:800,height:400}),2),c=l[0],d=l[1],u=ee((0,r.useState)(null),2),f=u[0],p=u[1],h=ee((0,r.useState)(null),2),m=h[0],y=h[1],b=ee((0,r.useState)(!1),2),E=b[0],T=b[1],j=ee((0,r.useState)(null),2),M=j[0],O=j[1],k=ee((0,r.useState)(null),2),A=k[0],D=k[1],L=N(),z=L.elements,R=L.selectedElements,F=L.selectedTool,J=L.grid,W=L.dimensionsVisible,V=L.debugNumbersVisible,B=L.orthogonalSnap,q=L.currentLineStart,Z=L.isDrawing,_=L.setCurrentLineStart,U=L.setIsDrawing,G=L.addElement,Y=L.deleteElement,X=L.selectElement,$=L.deleteSelectedElements,K=L.updateElement,te=g(J.stepMM),ne=N(function(e){return e.viewbox}),re=N(function(e){return e.zoom}),ie=N(),oe=(ie.zoomIn,ie.zoomOut,ie.setZoom),ae=(ie.resetZoom,(0,r.useRef)(re));(0,r.useEffect)(function(){var e=function(){if(t.current){var e=t.current.getBoundingClientRect();d({width:e.width,height:e.height})}};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}},[]),(0,r.useEffect)(function(){if(e.current){if("undefined"==typeof paper){var t=setInterval(function(){"undefined"!=typeof paper&&(clearInterval(t),r())},100);return function(){return clearInterval(t)}}return r(),function(){n.current&&n.current.remove()}}function r(){if(e.current){var t=e.current,r=c.width||ne.width,i=c.height||ne.height;t.width=r,t.height=i;var o=new paper.PaperScope;o.setup(t),o.activate();var a=N.getState().zoom;o.view.scale(a,new paper.Point(r/2,i/2));var l=new paper.Point(r/2,i/2),d=o.view.viewToProject(l);D(d),n.current=o,s(o.project)}}},[]),(0,r.useEffect)(function(){if(e.current&&n.current){var t=e.current,r=c.width||ne.width,i=c.height||ne.height;if(t.width!==r||t.height!==i){t.width=r,t.height=i;var o=n.current;o.activate(),o.view.viewSize=new paper.Size(r,i),o.view.draw()}}},[c.width,c.height,ne.width,ne.height]),(0,r.useEffect)(function(){if(n.current){var e=n.current;e.activate();var t=c.width||ne.width,r=c.height||ne.height,i=2!==ae.current&&2===re;ae.current=re,i&&A&&(e.view.center=A);var o=e.view.zoom||1,a=re/o;e.view.scale(a,new paper.Point(t/2,r/2)),e.view.draw()}},[re,c.width,c.height,ne.width,ne.height,A]),(0,r.useEffect)(function(){var t=e.current;if(t&&n.current){var r=function(e){e.preventDefault(),e.stopPropagation();var r=n.current;if(r){r.activate();var i=t.getBoundingClientRect(),o=new paper.Point(e.clientX-i.left,e.clientY-i.top),a=r.view.viewToProject(o),s=e.deltaY>0?.9:1.1,l=N.getState().zoom,c=N.getState().getMinZoom(),d=Math.max(c,Math.min(10,l*s)),u=d/l;r.view.scale(u,a),oe(d)}};return t.addEventListener("wheel",r,{passive:!1}),function(){t.removeEventListener("wheel",r)}}},[oe]),(0,r.useEffect)(function(){var t=e.current;if(t&&n.current){var r=n.current,i=function(e){if(1===e.button||4===e.buttons){e.preventDefault(),e.stopPropagation(),T(!0);var n=t.getBoundingClientRect();O({x:e.clientX-n.left,y:e.clientY-n.top,viewCenter:r.view.center.clone()})}},o=function(e){if(E&&M){e.preventDefault(),e.stopPropagation(),r.activate();var n=t.getBoundingClientRect(),i=new paper.Point(e.clientX-n.left,e.clientY-n.top),o=new paper.Point(M.x,M.y),a=i.subtract(o),s=r.view.zoom||1,l=a.divide(s);r.view.center=M.viewCenter.subtract(l),r.view.draw()}},a=function(e){1!==e.button&&0!==e.buttons||(T(!1),O(null))},s=function(e){1===e.button&&e.preventDefault()};return t.addEventListener("mousedown",i),t.addEventListener("mousemove",o),t.addEventListener("mouseup",a),t.addEventListener("mouseleave",a),t.addEventListener("contextmenu",s),function(){t.removeEventListener("mousedown",i),t.removeEventListener("mousemove",o),t.removeEventListener("mouseup",a),t.removeEventListener("mouseleave",a),t.removeEventListener("contextmenu",s)}}},[E,M]),(0,r.useEffect)(function(){if(console.log("useEffect for rendering called, selectedTool:",F),a&&n.current){var e=n.current;e.activate(),e.project.clear(),J.visible&&se(e,te,!1),z.filter(function(e){return"fillet"===e.type});var t=new Set;R.forEach(function(e){"fillet"===e.type&&(e.line1Id&&t.add(e.line1Id),e.line2Id&&t.add(e.line2Id))});var r=de(z);z.forEach(function(n){var i=R.some(function(e){return e.id===n.id});if("line"===n.type){var o=t.has(n.id);ue(e,n,i||o,!1,null,r)}else"arc"===n.type?fe(e,n,i):"fillet"===n.type&&pe(e,n,i,z,r)}),"arc"===F&&ce(z).forEach(function(e,t){var n=new paper.Path.Circle({center:[e.point.x,e.point.y],radius:1.6,fillColor:"#ff6600",strokeColor:"#fff",strokeWidth:2});n.data={type:"connectionPoint",connectionPoint:e,index:t},n.bringToFront()}),e.view.draw()}else console.log("Paper project not ready")},[z,R,J,W,V,a,te,F]),(0,r.useEffect)(function(){if(a&&n.current){var t=n.current;t.activate();var r=new paper.Tool;return r.onMouseDown=function(e){var t={x:e.point.x,y:e.point.y},n=w(t,te);if("line"===F)if(q){var r=w(B?S(q,n):n,te);G({type:"line",start:q,end:r,length:v(q,r)}),_(r),U(!0)}else _(n),U(!0);else if("select"===F){var i,o=null,a=Q(R);try{for(a.s();!(i=a.n()).done;){var s=i.value;if("line"===s.type){var l=v(t,s.start),c=v(t,s.end);if(l<8){o={elementId:s.id,pointType:"start",point:s.start};break}if(c<8){o={elementId:s.id,pointType:"end",point:s.end};break}}}}catch(e){a.e(e)}finally{a.f()}if(o){var d=le(o.elementId,o.pointType,o.point,z,R);p(d)}else{var u=z.find(function(e){if("fillet"===e.type){var n=v(t,e.arc.center);return Math.abs(n-e.arc.radius)<10}return!1});u||(u=z.find(function(e){if("line"===e.type)return P(t,e.start,e.end,10);if("arc"===e.type){var n=v(t,e.center);return Math.abs(n-e.radius)<10}return!1})),u?X(u,!0):X(null)}}else if("delete"===F){var f=z.find(function(e){if("line"===e.type)return P(t,e.start,e.end,10);if("arc"===e.type){var n=v(t,e.center);return Math.abs(n-e.radius)<10}if("fillet"===e.type){var r=v(t,e.arc.center),i=Math.abs(r-e.arc.radius)<10,o=z.find(function(t){return t.id===e.line1Id}),a=z.find(function(t){return t.id===e.line2Id}),s=!(!o||"line"!==o.type)&&P(t,o.start,o.end,10),l=!(!a||"line"!==a.type)&&P(t,a.start,a.end,10);return s||l||i}return!1});f?Y(f.id):R.length>0&&$()}else if("arc"===F){fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:320",message:"arc mode click",data:{point:{x:t.x,y:t.y}},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"A"})}).catch(function(){});var h=z.find(function(e){if("fillet"===e.type){var n=v(t,e.arc.center);return Math.abs(n-e.arc.radius)<10}return!1}),m=z.find(function(e){if("arc"===e.type){var n=v(t,e.center);return Math.abs(n-e.radius)<10}return!1});if(fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:342",message:"fillet/arc check",data:{clickedFillet:!!h,clickedArc:!!m},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"B"})}).catch(function(){}),h)X(h);else if(m)X(m);else{var y=ce(z);fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:349",message:"checking connection points",data:{connectionPointsCount:y.length,connectionPoints:y.map(function(e){return{point:{x:e.point.x,y:e.point.y},line1Id:e.line1.id,line2Id:e.line2.id}})},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"A"})}).catch(function(){});var g=y.find(function(e){var n=v(t,e.point);return fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:352",message:"distance check",data:{clickPoint:{x:t.x,y:t.y},cpPoint:{x:e.point.x,y:e.point.y},dist:n,threshold:10,withinRange:n<10},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"A"})}).catch(function(){}),n<10});if(fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:356",message:"connection point click result",data:{clickedConnection:!!g,clickedConnectionData:g?{point:{x:g.point.x,y:g.point.y},line1Id:g.line1.id,line2Id:g.line2.id}:null},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"A"})}).catch(function(){}),g){var b=N.getState(),x=b.elements.find(function(e){return e.id===g.line1.id}),E=b.elements.find(function(e){return e.id===g.line2.id});if(fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:362",message:"before createFilletAtCorner",data:{line1FromStore:!!x,line2FromStore:!!E,line1Id:g.line1.id,line2Id:g.line2.id},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"B"})}).catch(function(){}),x&&E&&"line"===x.type&&"line"===E.type){fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:363",message:"calling createFilletAtCorner",data:{line1Id:x.id,line2Id:E.id},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"B"})}).catch(function(){});try{ye(x,E),fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:363",message:"createFilletAtCorner completed",data:{},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"B"})}).catch(function(){})}catch(e){fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:363",message:"createFilletAtCorner error",data:{error:e.message,stack:e.stack},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"B"})}).catch(function(){})}X(null)}}else X(null)}}},r.onMouseMove=function(n){var r={x:n.point.x,y:n.point.y},i=w(r,te),o=null,a=null;if("select"===F){var s,l=Q(R);try{for(l.s();!(s=l.n()).done;){var c=s.value;if("line"===c.type){var d=v(r,c.start),u=v(r,c.end);if(d<8){a={elementId:c.id,pointType:"start"},e.current&&(e.current.style.cursor="pointer");break}if(u<8){a={elementId:c.id,pointType:"end"},e.current&&(e.current.style.cursor="pointer");break}}}}catch(e){l.e(e)}finally{l.f()}a||(o=z.find(function(e){if("line"===e.type)return P(r,e.start,e.end,10);if("arc"===e.type){var t=v(r,e.center);return Math.abs(t-e.radius)<10}if("fillet"===e.type){var n=v(r,e.arc.center),i=Math.abs(n-e.arc.radius)<10,o=z.find(function(t){return t.id===e.line1Id}),a=z.find(function(t){return t.id===e.line2Id}),s=!(!o||"line"!==o.type)&&P(r,o.start,o.end,10),l=!(!a||"line"!==a.type)&&P(r,a.start,a.end,10);return s||l||i}return!1}),e.current&&!o&&(e.current.style.cursor="default"))}else"arc"===F?o=z.find(function(e){if("fillet"===e.type){var t=v(r,e.arc.center);return Math.abs(t-e.arc.radius)<10}if("arc"===e.type){var n=v(r,e.center);return Math.abs(n-e.radius)<10}return!1}):"delete"===F&&(o=z.find(function(e){if("line"===e.type)return P(r,e.start,e.end,10);if("arc"===e.type){var t=v(r,e.center);return Math.abs(t-e.radius)<10}if("fillet"===e.type){var n=v(r,e.arc.center),i=Math.abs(n-e.arc.radius)<10,o=z.find(function(t){return t.id===e.line1Id}),a=z.find(function(t){return t.id===e.line2Id}),s=!(!o||"line"!==o.type)&&P(r,o.start,o.end,10),l=!(!a||"line"!==a.type)&&P(r,a.start,a.end,10);return s||l||i}return!1}),e.current&&(e.current.style.cursor=o?"not-allowed":"default"));y(a),t.project.clear(),J.visible&&se(t,te,!1),z.filter(function(e){return"fillet"===e.type});var f=new Set;R.forEach(function(e){"fillet"===e.type&&(e.line1Id&&f.add(e.line1Id),e.line2Id&&f.add(e.line2Id))});var p=de(z);if(z.forEach(function(e){var n=R.some(function(t){return t.id===e.id}),r=o&&o.id===e.id,i="delete"===F&&r;if("line"===e.type){var s=f.has(e.id);ue(t,e,n||s,r&&"delete"!==F,a,p,i)}else"arc"===e.type?fe(t,e,n,r&&"delete"!==F,i):"fillet"===e.type&&pe(t,e,n||o&&o.id===e.id&&"delete"!==F,z,p,i)}),"arc"===F&&ce(z).forEach(function(e,t){var n=new paper.Path.Circle({center:[e.point.x,e.point.y],radius:2.6,fillColor:"#ff6600",strokeColor:"#fff",strokeWidth:2});n.data={type:"connectionPoint",connectionPoint:e,index:t},n.bringToFront()}),"line"===F){var h=i;if(q){U(!0),h=w(B?S(q,i):i,te),new paper.Path.Line({from:[q.x,q.y],to:[h.x,h.y],strokeColor:"#999",strokeWidth:2});var m=x(v(q,h)),g=(q.x+h.x)/2,b=(q.y+h.y)/2,E=45*Math.PI/180,C=g,I=b,T=g+15*Math.cos(E),j=b-15*Math.sin(E),M=T,O=j,k=T+40,A=j,D=O-3,N="#999",L=(Math.abs(q.x-h.x),new paper.Path.Line({from:[C,I],to:[T,j],strokeColor:N,strokeWidth:.5}),new paper.Path.Line({from:[M,O],to:[k,A],strokeColor:N,strokeWidth:.5}),new paper.PointText({point:[0,0],content:m,fillColor:N,fontSize:11})),W=L.bounds.width;L.remove();var V=k-W;new paper.PointText({point:[V,D],content:m,fillColor:N,fontSize:11})}new paper.Path.Circle({center:[h.x,h.y],radius:2.6,fillColor:"#0066cc",strokeColor:"#ffffff",strokeWidth:.5})}t.view.draw()},r.onMouseDrag=function(e){var n=N.getState();if(f&&Array.isArray(f)&&f.length>0&&"select"===n.selectedTool){var r={x:e.point.x,y:e.point.y},i=f[0],o=n.elements.find(function(e){return e.id===i.elementId});if(o&&"line"===o.type){var a;if(1===f.length){var s=o.end.x-o.start.x,l=o.end.y-o.start.y,c=Math.sqrt(s*s+l*l);if(c>0){var d=s/c,u=l/c,p="start"===i.pointType?o.start:o.end,h={x:r.x-p.x,y:r.y-p.y},m=h.x*d+h.y*u,y={x:p.x+m*d,y:p.y+m*u};a=w(y,te)}else a=w(r,te)}else a=w(r,te);f.forEach(function(e){var t=n.elements.find(function(t){return t.id===e.elementId});t&&"line"===t.type&&("start"===e.pointType?n.updateElement(t.id,{start:a,length:v(a,t.end)}):n.updateElement(t.id,{end:a,length:v(t.start,a)}))});var g=N.getState();t.project.clear(),g.grid.visible&&se(t,te,!1),g.elements.filter(function(e){return"fillet"===e.type});var b=new Set;g.selectedElements.forEach(function(e){"fillet"===e.type&&(e.line1Id&&b.add(e.line1Id),e.line2Id&&b.add(e.line2Id))});var x=de(g.elements);g.elements.forEach(function(e){var n=g.selectedElements.some(function(t){return t.id===e.id});if("line"===e.type){var r=b.has(e.id);ue(t,e,n||r,!1,null,x)}else"arc"===e.type?fe(t,e,n,!1):"fillet"===e.type&&pe(t,e,n,g.elements,x)}),t.view.draw()}}},r.onMouseUp=function(e){p(function(e){return e?null:e})},r.activate(),function(){r.remove()}}},[F,q,Z,z,R,te,a,J,W,V,B,G,X,Y,$,U,_,f,K,m]),(0,r.useEffect)(function(){var e=function(e){"Escape"===e.key&&Z&&(_(null),U(!1))};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}},[Z]),(0,r.useEffect)(function(){var t=e.current;if(t){var n=function(){y(null),t.style.cursor="default"};return t.addEventListener("mouseleave",n),function(){t.removeEventListener("mouseleave",n)}}},[]);var se=function(e,t,n){var r=e.view,i=r.viewSize.width||c.width||ne.width,o=r.viewSize.height||c.height||ne.height,a=new paper.Layer;a.name="grid";for(var s=0;s<=i;s+=t){var l=new paper.Path.Line({from:[s,0],to:[s,o],strokeColor:"#e0e0e0",strokeWidth:.5});a.addChild(l)}for(var d=0;d<=o;d+=t){var u=new paper.Path.Line({from:[0,d],to:[i,d],strokeColor:"#e0e0e0",strokeWidth:.5});a.addChild(u)}if(n){for(var f=g(10),p=0;p<=i;p+=f){var h=new paper.Path.Line({from:[p,0],to:[p,o],strokeColor:"#999",strokeWidth:1});a.addChild(h)}for(var m=0;m<=o;m+=f){var y=new paper.Path.Line({from:[0,m],to:[i,m],strokeColor:"#999",strokeWidth:1});a.addChild(y)}}a.locked=!0},le=function(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=[{elementId:e,pointType:t}],s=r.find(function(t){return t.id===e});if(!s||"line"!==s.type)return a;var l,c=s[t],d=Q(i);try{var u=function(){var t=l.value;if(t.id===e||"line"!==t.type)return 1;v(c,t.start)<o&&(a.some(function(e){return e.elementId===t.id&&"start"===e.pointType})||a.push({elementId:t.id,pointType:"start"})),v(c,t.end)<o&&(a.some(function(e){return e.elementId===t.id&&"end"===e.pointType})||a.push({elementId:t.id,pointType:"end"}))};for(d.s();!(l=d.n()).done;)u()}catch(e){d.e(e)}finally{d.f()}return a},ce=function(e){console.log("=== findAllConnectionPoints CALLED ===");var t=[],n=e.filter(function(e){return"line"===e.type});console.log("findAllConnectionPoints: looking for connections between",n.length,"lines");for(var r=0;r<n.length;r++)for(var i=function(){var i=n[r],a=n[o];if(e.find(function(e){return"fillet"===e.type&&(e.line1Id===i.id&&e.line2Id===a.id||e.line1Id===a.id&&e.line2Id===i.id)}))return 1;var s=I(i,a,10);console.log("Checking connection between lines",i.id,"and",a.id,":",s),s&&(console.log("Connection found!",s),t.push({point:s,line1:i,line2:a}))},o=r+1;o<n.length;o++)i();return console.log("findAllConnectionPoints: found",t.length,"connection points"),t},de=function(e){var t=new Map,n=1,r=e.filter(function(e){return"line"===e.type}),i=[];r.forEach(function(e){i.push({elementId:e.id,pointType:"start",point:e.start,line:e}),i.push({elementId:e.id,pointType:"end",point:e.end,line:e})});for(var o=function(){var e="".concat(i[a].elementId,":").concat(i[a].pointType);if(t.has(e))return 1;for(var r=[i[a]],o=a+1;o<i.length;o++)v(i[a].point,i[o].point)<10&&r.push(i[o]);var s=n++;r.forEach(function(e){var n="".concat(e.elementId,":").concat(e.pointType);t.set(n,s)})},a=0;a<i.length;a++)o();return t},ue=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a="#000",s=2;if(arguments.length>6&&void 0!==arguments[6]&&arguments[6]?(a="#ff0000",s=3):n?(a="#0073aa",s=3):r&&(a="#0073aa",s=2),new paper.Path.Line({from:[t.start.x,t.start.y],to:[t.end.x,t.end.y],strokeColor:a,strokeWidth:s}).data={elementId:t.id,type:"line"},n&&"line"===t.type){var l=i&&i.elementId===t.id&&"start"===i.pointType,c=i&&i.elementId===t.id&&"end"===i.pointType;new paper.Path.Circle({center:[t.start.x,t.start.y],radius:2.6,fillColor:l?"#ff8800":"#0073aa",strokeColor:"#fff",strokeWidth:2}).data={elementId:t.id,pointType:"start",type:"linePoint"},new paper.Path.Circle({center:[t.end.x,t.end.y],radius:2.6,fillColor:c?"#ff8800":"#0073aa",strokeColor:"#fff",strokeWidth:2}).data={elementId:t.id,pointType:"end",type:"linePoint"}}if(o&&V){var d="".concat(t.id,":start"),u="".concat(t.id,":end"),f=o.get(d),p=o.get(u);void 0!==f&&new paper.PointText({point:[t.start.x+8,t.start.y-8],content:"".concat(f),fillColor:"#ff0000",fontSize:12,fontWeight:"bold"}),void 0!==p&&new paper.PointText({point:[t.end.x+8,t.end.y-8],content:"".concat(p),fillColor:"#ff0000",fontSize:12,fontWeight:"bold"})}W&&he(e,t,n||r)},fe=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=new paper.Point(t.center.x,t.center.y),a=t.radius,s=t.startAngle||0,l=t.angle||90,c=s*Math.PI/180,d=c+l*Math.PI/180,u=new paper.Point(o.x+a*Math.cos(c),o.y+a*Math.sin(c)),f=new paper.Point(o.x+a*Math.cos(d),o.y+a*Math.sin(d)),p=c+l*Math.PI/360,h=new paper.Point(o.x+a*Math.cos(p),o.y+a*Math.sin(p)),m=new paper.Path.Arc({from:u,through:h,to:f});i?(m.strokeColor="#ff0000",m.strokeWidth=3):n?(m.strokeColor="#0073aa",m.strokeWidth=3):r?(m.strokeColor="#0073aa",m.strokeWidth=2):(m.strokeColor="#000",m.strokeWidth=2),m.data={elementId:t.id,type:"arc"}},pe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if("fillet"===t.type){var a,s,l=o?"#ff0000":n?"#0073aa":"#000",c=o||n?3:2,d=t.arc;if(fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1078",message:"drawFillet checking saved points",data:{hasArcStartPoint:!!t.arcStartPoint,hasArcEndPoint:!!t.arcEndPoint,arcStartPoint:t.arcStartPoint,arcEndPoint:t.arcEndPoint},timestamp:Date.now(),sessionId:"debug-session",runId:"debug",hypothesisId:"E"})}).catch(function(){}),t.arcStartPoint&&t.arcEndPoint)a=new paper.Point(t.arcStartPoint.x,t.arcStartPoint.y),s=new paper.Point(t.arcEndPoint.x,t.arcEndPoint.y),fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1081",message:"drawFillet using saved points",data:{startPoint:{x:a.x,y:a.y},endPoint:{x:s.x,y:s.y}},timestamp:Date.now(),sessionId:"debug-session",runId:"debug",hypothesisId:"E"})}).catch(function(){});else{var u=d.startAngle*Math.PI/180,f=u+d.angle*Math.PI/180;a=new paper.Point(d.center.x+d.radius*Math.cos(u),d.center.y+d.radius*Math.sin(u)),s=new paper.Point(d.center.x+d.radius*Math.cos(f),d.center.y+d.radius*Math.sin(f)),fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1094",message:"drawFillet using calculated points",data:{startPoint:{x:a.x,y:a.y},endPoint:{x:s.x,y:s.y}},timestamp:Date.now(),sessionId:"debug-session",runId:"debug",hypothesisId:"E"})}).catch(function(){})}var p=r.find(function(e){return e.id===t.line1Id}),h=r.find(function(e){return e.id===t.line2Id});if(p&&h){var m=p.end,y=p.start,v=h.end,g=h.start,b=a.getDistance(new paper.Point(m.x,m.y)),x=a.getDistance(new paper.Point(y.x,y.y)),E=s.getDistance(new paper.Point(v.x,v.y)),w=s.getDistance(new paper.Point(g.x,g.y));fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:890",message:"drawFillet arc vs line points",data:{arcStartPoint:{x:a.x,y:a.y},arcEndPoint:{x:s.x,y:s.y},line1:{start:y,end:m},line2:{start:g,end:v},distStartToLine1End:b,distStartToLine1Start:x,distEndToLine2End:E,distEndToLine2Start:w,expectedArcStartPoint:t.arcStartPoint,expectedArcEndPoint:t.arcEndPoint},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"C"})}).catch(function(){})}var S=new paper.Point(d.center.x,d.center.y),P=Math.atan2(a.y-S.y,a.x-S.x),C=Math.atan2(s.y-S.y,s.x-S.x)-P;C>Math.PI?C-=2*Math.PI:C<-Math.PI&&(C+=2*Math.PI);var I=new paper.Path;I.add(a);for(var T=Math.max(8,Math.ceil(180*Math.abs(C)/Math.PI/5)),j=1;j<T;j++){var M=P+j/T*C,O=new paper.Point(S.x+d.radius*Math.cos(M),S.y+d.radius*Math.sin(M));I.add(O)}if(I.add(s),I.strokeColor=l,I.strokeWidth=c,I.data={elementId:t.id,type:"fillet-arc"},i&&p&&h&&V){var k=a.getDistance(new paper.Point(p.end.x,p.end.y)),A=a.getDistance(new paper.Point(p.start.x,p.start.y)),D=s.getDistance(new paper.Point(h.end.x,h.end.y)),N=s.getDistance(new paper.Point(h.start.x,h.start.y)),L=k<A?"end":"start",R="".concat(p.id,":").concat(L),F=i.get(R),J=D<N?"end":"start",B="".concat(h.id,":").concat(J),q=i.get(B);void 0!==F&&new paper.PointText({point:[a.x+8,a.y-8],content:"A".concat(F),fillColor:"#00ff00",fontSize:12,fontWeight:"bold"}),void 0!==q&&new paper.PointText({point:[s.x+8,s.y-8],content:"A".concat(q),fillColor:"#00ff00",fontSize:12,fontWeight:"bold"})}fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1244",message:"before drawFilletDimensionCallout",data:{dimensionsVisible:W,hasArcCenter:!!d.center,arcCenter:d.center,arcRadius:d.radius},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"D"})}).catch(function(){}),W&&d.center&&me(e,t,n,d.center,d.radius,i,r)}},he=function(e,t,n){if("line"===t.type){var r=(t.start.x+t.end.x)/2,i=(t.start.y+t.end.y)/2,o=45*Math.PI/180,a=r,s=i,l=r+15*Math.cos(o),c=i-15*Math.sin(o),d=l,u=c,f=l+40,p=c,h=u-3,m=x(t.length||v(t.start,t.end)),y=n?"#0073aa":"#999",g=(Math.abs(t.start.x-t.end.x),new paper.Path.Line({from:[a,s],to:[l,c],strokeColor:y,strokeWidth:.5}),new paper.Path.Line({from:[d,u],to:[f,p],strokeColor:y,strokeWidth:.5}),new paper.PointText({point:[0,0],content:m,fillColor:y,fontSize:11})),b=g.bounds.width;g.remove();var E=f-b;new paper.PointText({point:[E,h],content:m,fillColor:y,fontSize:11})}},me=function(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];if("fillet"===t.type){var s=null,l=null;if(o&&t.line1Id&&t.line2Id){var c=a.find(function(e){return e.id===t.line1Id&&"line"===e.type}),d=a.find(function(e){return e.id===t.line2Id&&"line"===e.type});if(c&&d&&t.arcStartPoint&&t.arcEndPoint){var u=v(t.arcStartPoint,c.end),f=v(t.arcStartPoint,c.start),p=v(t.arcEndPoint,d.end),h=v(t.arcEndPoint,d.start),m=u<f?"end":"start",y="".concat(c.id,":").concat(m);s=o.get(y);var g=p<h?"end":"start",b="".concat(d.id,":").concat(g);l=o.get(b)}}fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1357",message:"drawFilletDimensionCallout called",data:{arcCenter:r,arcRadius:i,line1PointNumber:s,line2PointNumber:l,isAngle6_7:6===s&&7===l||7===s&&6===l,isAngle14_15:14===s&&15===l||15===s&&14===l},timestamp:Date.now(),sessionId:"debug-session",runId:"analyze-angles",hypothesisId:"A"})}).catch(function(){});var E,w,S=r.x,P=r.y;if(t.arcStartPoint&&t.arcEndPoint){var C=(E=(t.arcStartPoint.x+t.arcEndPoint.x)/2)-S,I=(w=(t.arcStartPoint.y+t.arcEndPoint.y)/2)-P,T=Math.sqrt(C*C+I*I);T>1e-4&&(E=S+C/T*i,w=P+I/T*i)}else{var j=t.arc,M=j.startAngle*Math.PI/180+j.angle*Math.PI/180/2;E=S+Math.cos(M)*i,w=P+Math.sin(M)*i}fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1345",message:"arc midpoint calculation",data:{arcCenter:{x:S,y:P},arcRadius:i,arcStartPoint:t.arcStartPoint,arcEndPoint:t.arcEndPoint,arcPoint:{x:E,y:w}},timestamp:Date.now(),sessionId:"debug-session",runId:"check-arc-midpoint",hypothesisId:"F"})}).catch(function(){});var O,k=S,A=P,D=E,N=w;if(t.line1Direction&&t.line2Direction){var L={x:t.line1Direction.x+t.line2Direction.x,y:t.line1Direction.y+t.line2Direction.y},z=Math.sqrt(L.x*L.x+L.y*L.y),R=z>1e-4?{x:L.x/z,y:L.y/z}:{x:-t.line1Direction.y,y:t.line1Direction.x};O={x:-R.x,y:-R.y}}else{var F={x:E-S,y:w-P},J=Math.sqrt(F.x*F.x+F.y*F.y);if(J>1e-4){var W={x:F.x/J,y:F.y/J};O={x:-W.y,y:W.x}}else O={x:Math.cos(45*Math.PI/180),y:-Math.sin(45*Math.PI/180)}}var V=E+15*O.x,B=w+15*O.y,q=V,Z=B,_=V+40,U=B,G=O.y<0;fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1475",message:"text placement analysis",data:{line1PointNumber:s,line2PointNumber:l,textAboveLine:G,horizontalStartY:Z,centerY:P,outsideDir:O,outsideDirY:O.y},timestamp:Date.now(),sessionId:"debug-session",runId:"analyze-angles",hypothesisId:"B"})}).catch(function(){});var Y=G?Z-3:Z+14,X="R "+x(i),$=n?"#0073aa":"#999",H=(new paper.Path.Line({from:[k,A],to:[D,N],strokeColor:$,strokeWidth:.5}),new paper.Path.Line({from:[E,w],to:[V,B],strokeColor:$,strokeWidth:.5}),new paper.Path.Line({from:[q,Z],to:[_,U],strokeColor:$,strokeWidth:.5}),new paper.PointText({point:[0,0],content:X,fillColor:$,fontSize:11})),K=H.bounds.width;H.remove();var Q=_-K;new paper.PointText({point:[Q,Y],content:X,fillColor:$,fontSize:11})}},ye=function(e,t){var n=N.getState(),r=n.elements.find(function(t){return t.id===e.id}),i=n.elements.find(function(e){return e.id===t.id});if(r&&i&&"line"===r.type&&"line"===i.type){var o=r.id<i.id?r:i,a=r.id<i.id?i:r;fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1142",message:"createFilletAtCorner entry with actual lines",data:{line1:{id:o.id,start:o.start,end:o.end},line2:{id:a.id,start:a.start,end:a.end}},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"C"})}).catch(function(){});var s=I(o,a,10);if(s){fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:976",message:"connection found",data:{connection:s,line1End:s.line1End,line2End:s.line2End},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"A"})}).catch(function(){});var l=g(3),c=v(s,o.start),d=v(s,o.end),u=v(s,a.start),f=v(s,a.end);fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:985",message:"distances calculated",data:{distToLine1Start:c,distToLine1End:d,distToLine2Start:u,distToLine2End:f,line1EndCloser:d<c,line2EndCloser:f<u},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"D"})}).catch(function(){});var p=C(o),h=C(a),m=d<c?{x:-p.x,y:-p.y}:p,y=f<u?{x:-h.x,y:-h.y}:h,b={x:s.x+m.x*l,y:s.y+m.y*l},x={x:s.x+y.x*l,y:s.y+y.y*l},E=m,w=y,S=Math.atan2(E.y,E.x)*(180/Math.PI),P=Math.atan2(w.y,w.x)*(180/Math.PI);fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:993",message:"directions calculated",data:{dir1:E,dir2:w,line1Dir:p,line2Dir:h,line1DirToFar:m,line2DirToFar:y,arcStartPoint:b,arcEndPoint:x},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"A"})}).catch(function(){}),fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1004",message:"arc points calculated",data:{arcStartPoint:b,arcEndPoint:x,arcRadius:l,angle1:S,angle2:P},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"B"})}).catch(function(){});var T=Math.abs(P-S);T>180&&(T=360-T);var j,M=T*Math.PI/180,O={x:-E.y,y:E.x},k={x:-w.y,y:w.x},A=E.x+w.x,D=E.y+w.y,L=Math.sqrt(A*A+D*D),z=L>1e-4?{x:A/L,y:D/L}:{x:-E.y,y:E.x},R=O.x*z.x+O.y*z.y>0?O:{x:-O.x,y:-O.y},F=k.x*z.x+k.y*z.y>0?k:{x:-k.x,y:-k.y},J=x.x-b.x,W=x.y-b.y,V=R.x*F.y-R.y*F.x;if(Math.abs(V)<1e-4){var B=M>1e-4?l/Math.sin(M/2):l;j={x:s.x+z.x*B,y:s.y+z.y*B}}else{var q=(J*F.y-W*F.x)/V;j={x:b.x+q*R.x,y:b.y+q*R.y}}var Z=M>1e-4?l/Math.sin(M/2):l;fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1560",message:"arc center calculation",data:{angle1:S,angle2:P,angleDiff:T,angleDiffRad:M,arcCenter:j,arcRadius:l,connection:s,dir1:E,dir2:w,bisectorDir:z,centerDist:Z,arcStartPoint:b,arcEndPoint:x,distFromCenterToStart:v(j,b),distFromCenterToEnd:v(j,x)},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"A"})}).catch(function(){});var _=Math.atan2(b.y-j.y,b.x-j.x),U=Math.atan2(x.y-j.y,x.x-j.x)-_;U>Math.PI?U-=2*Math.PI:U<-Math.PI&&(U+=2*Math.PI);var Y=_*(180/Math.PI);Y>180&&(Y-=360),Y<-180&&(Y+=360);var $=Math.abs(U)*(180/Math.PI),Q=b,ee=x,te=o.length||v(o.start,o.end),ne=a.length||v(a.start,a.end),re=Q,ie=ee,oe=v(re,o.end),ae=v(re,o.start),se=oe+.01<ae,le=v(ie,a.end),ce=v(ie,a.start),de=le+.01<ce,ue=se?{end:re,length:te}:{start:re,length:te},fe=de?{end:ie,length:ne}:{start:ie,length:ne};fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1234",message:"before updateElement",data:{line1Id:o.id,line1:{start:o.start,end:o.end},line1Update:ue,line2Id:a.id,line2:{start:a.start,end:a.end},line2Update:fe,arcStartPoint:Q,arcEndPoint:ee,originalArcStartPoint:b,originalArcEndPoint:x,line1EndTruncated:se,line2EndTruncated:de,distArcPoint1ToLine1End:oe,distArcPoint1ToLine1Start:ae,distArcPoint2ToLine2End:le,distArcPoint2ToLine2Start:ce,distToLine1Start:c,distToLine1End:d,distToLine2Start:u,distToLine2End:f,connection:s,dir1:E,dir2:w,arcCenter:j},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"A"})}).catch(function(){}),K(o.id,ue),K(a.id,fe);var pe=N.getState(),he=pe.elements.find(function(e){return e.id===o.id}),me=pe.elements.find(function(e){return e.id===a.id});fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1254",message:"after updateElement",data:{line1After:{start:null==he?void 0:he.start,end:null==he?void 0:he.end},line2After:{start:null==me?void 0:me.start,end:null==me?void 0:me.end},arcStartPoint:Q,arcEndPoint:ee,expectedLine1End:se?Q:o.end,expectedLine2Start:de?a.start:ee},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"B"})}).catch(function(){});var ye={type:"fillet",radius:l,line1Id:o.id,line2Id:a.id,arc:{center:j,radius:l,startAngle:Y,angle:$},arcStartPoint:re,arcEndPoint:ie,connection:s,line1Direction:E,line2Direction:w,angle1:S,angle2:P,line1EndTruncated:se,line2EndTruncated:de};fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1088",message:"fillet created",data:{fillet:H(H({},ye),{},{arc:H({},ye.arc)})},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"C"})}).catch(function(){}),G(ye),X(null)}}};return i().createElement("div",{ref:t,className:"canvas-editor"},i().createElement("canvas",{ref:e,id:"plintus-paperjs-canvas",style:{width:"100%",height:"100%",display:"block"}}))};var ie=n(925),oe={};oe.styleTagTransform=U(),oe.setAttributes=B(),oe.insert=W().bind(null,"head"),oe.domAPI=F(),oe.insertStyleElement=Z(),z()(ie.A,oe),ie.A&&ie.A.locals&&ie.A.locals;var ae=function(){return i().createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.9993 16.1803V9C19.9993 6.32472 17.8982 4.14053 15.2561 4.00684L14.9993 4L7.81931 4.00029C7.6522 3.52063 7.36603 3.09125 6.98763 2.7524C6.60923 2.41355 6.15099 2.17633 5.65586 2.06297C5.16074 1.94961 4.64493 1.96382 4.15679 2.10427C3.66866 2.24472 3.22418 2.50682 2.86501 2.86598C2.50584 3.22515 2.24375 3.66963 2.1033 4.15777C1.96284 4.64591 1.94863 5.16171 2.062 5.65684C2.17536 6.15197 2.41258 6.61021 2.75143 6.98861C3.09027 7.36701 3.382 7.54729 3.99931 7.82029C4.61663 8.09329 5.5 8 5.99931 7.82029C6.49862 7.64058 6.79962 7.43018 7.11441 7.11539C7.42921 6.80059 7.66999 6.41969 7.81931 6.00029L14.9993 6C16.6562 6 17.9993 7.34315 17.9993 9V16.1803C17.5799 16.3296 17.199 16.5704 16.8842 16.8852C16.5694 17.2 16.3286 17.5809 16.1793 18.0003C16.0014 18.5 16.0122 19.5206 16.1793 20.0003C16.3464 20.48 16.6326 20.9093 17.011 21.2482C17.3894 21.587 17.8476 21.8242 18.3428 21.9376C18.8379 22.051 19.3537 22.0368 19.8418 21.8963C20.33 21.7559 20.7744 21.4938 21.1336 21.1346C21.4928 20.7754 21.7549 20.3309 21.8953 19.8428C22.0358 19.3547 22.05 18.8389 21.9366 18.3437C21.8233 17.8486 21.586 17.3904 21.2472 17.012C20.9084 16.6336 20.479 16.3474 19.9993 16.1803ZM5.55488 4.16882C5.39043 4.05894 5.19709 4.00029 4.99931 4.00029C4.7341 4.00029 4.47974 4.10565 4.29221 4.29318C4.10467 4.48072 3.99931 4.73507 3.99931 5.00029C3.99931 5.19807 4.05796 5.39141 4.16784 5.55586C4.27772 5.72031 4.4339 5.84848 4.61663 5.92417C4.79936 5.99986 5.00042 6.01966 5.1944 5.98107C5.38838 5.94249 5.56657 5.84725 5.70642 5.7074C5.84627 5.56754 5.94151 5.38936 5.9801 5.19538C6.01868 5.0014 5.99888 4.80033 5.92319 4.61761C5.8475 4.43488 5.71933 4.2787 5.55488 4.16882ZM18.4437 19.8318C18.6082 19.9416 18.8015 20.0003 18.9993 20.0003C19.2645 20.0003 19.5189 19.8949 19.7064 19.7074C19.894 19.5199 19.9993 19.2655 19.9993 19.0003C19.9993 18.8025 19.9407 18.6092 19.8308 18.4447C19.7209 18.2803 19.5647 18.1521 19.382 18.0764C19.1993 18.0007 18.9982 17.9809 18.8042 18.0195C18.6102 18.0581 18.4321 18.1533 18.2922 18.2932C18.1524 18.433 18.0571 18.6112 18.0185 18.8052C17.9799 18.9992 17.9997 19.2002 18.0754 19.383C18.1511 19.5657 18.2793 19.7219 18.4437 19.8318Z",fill:"currentColor"}))};const se=function(e){var t=e.tool,n=e.isActive,r=e.onClick;return i().createElement("button",{type:"button",className:"plintus-tool-button ".concat(n?"active":""),onClick:r,title:t.label},"arc"===t.id?i().createElement(ae,null):i().createElement("i",{className:"fs-28 uil ".concat(t.icon)}))},le=function(){var e=N(),t=e.selectedTool,n=e.setSelectedTool,r=e.dimensionsVisible,o=e.toggleDimensionsVisible,a=e.zoomIn,s=e.zoomOut,l=e.resetZoom;return i().createElement("div",{className:"plintus-toolbar"},i().createElement("div",{className:"plintus-toolbar-section"},[{id:"line",label:"Рисование",icon:"uil-edit-alt"},{id:"select",label:"Редактировать",icon:"uil-vector-square"},{id:"arc",label:"Скругление",icon:"uil-circle"},{id:"delete",label:"Удаление",icon:"uil-trash-alt"}].map(function(e){return i().createElement(se,{key:e.id,tool:e,isActive:t===e.id,onClick:function(){return n(e.id)}})})),i().createElement("div",{className:"plintus-toolbar-section plintus-toolbar-section-right"},i().createElement("button",{type:"button",onClick:function(e){e.preventDefault(),e.stopPropagation(),l()},title:"Сброс масштаба"},i().createElement("i",{className:"fs-28 uil uil-expand-arrows-alt"})),i().createElement("button",{type:"button",onClick:function(e){e.preventDefault(),e.stopPropagation(),s()},title:"Уменьшить"},i().createElement("i",{className:"fs-28 uil uil-minus-circle"})),i().createElement("button",{type:"button",onClick:function(e){e.preventDefault(),e.stopPropagation(),a()},title:"Приблизить"},i().createElement("i",{className:"fs-28 uil uil-plus-circle"})),i().createElement("button",{type:"button",onClick:function(e){e.preventDefault(),e.stopPropagation(),o()},className:r?"active":"",title:"Show/Hide Dimensions"},i().createElement("i",{className:"fs-28 uil uil-ruler"}))))};var ce=n(47),de={};de.styleTagTransform=U(),de.setAttributes=B(),de.insert=W().bind(null,"head"),de.domAPI=F(),de.insertStyleElement=Z(),z()(ce.A,de),ce.A&&ce.A.locals&&ce.A.locals;var ue=function(){return i().createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M19.9993 16.1803V9C19.9993 6.32472 17.8982 4.14053 15.2561 4.00684L14.9993 4L7.81931 4.00029C7.6522 3.52063 7.36603 3.09125 6.98763 2.7524C6.60923 2.41355 6.15099 2.17633 5.65586 2.06297C5.16074 1.94961 4.64493 1.96382 4.15679 2.10427C3.66866 2.24472 3.22418 2.50682 2.86501 2.86598C2.50584 3.22515 2.24375 3.66963 2.1033 4.15777C1.96284 4.64591 1.94863 5.16171 2.062 5.65684C2.17536 6.15197 2.41258 6.61021 2.75143 6.98861C3.09027 7.36701 3.382 7.54729 3.99931 7.82029C4.61663 8.09329 5.5 8 5.99931 7.82029C6.49862 7.64058 6.79962 7.43018 7.11441 7.11539C7.42921 6.80059 7.66999 6.41969 7.81931 6.00029L14.9993 6C16.6562 6 17.9993 7.34315 17.9993 9V16.1803C17.5799 16.3296 17.199 16.5704 16.8842 16.8852C16.5694 17.2 16.3286 17.5809 16.1793 18.0003C16.0014 18.5 16.0122 19.5206 16.1793 20.0003C16.3464 20.48 16.6326 20.9093 17.011 21.2482C17.3894 21.587 17.8476 21.8242 18.3428 21.9376C18.8379 22.051 19.3537 22.0368 19.8418 21.8963C20.33 21.7559 20.7744 21.4938 21.1336 21.1346C21.4928 20.7754 21.7549 20.3309 21.8953 19.8428C22.0358 19.3547 22.05 18.8389 21.9366 18.3437C21.8233 17.8486 21.586 17.3904 21.2472 17.012C20.9084 16.6336 20.479 16.3474 19.9993 16.1803ZM5.55488 4.16882C5.39043 4.05894 5.19709 4.00029 4.99931 4.00029C4.7341 4.00029 4.47974 4.10565 4.29221 4.29318C4.10467 4.48072 3.99931 4.73507 3.99931 5.00029C3.99931 5.19807 4.05796 5.39141 4.16784 5.55586C4.27772 5.72031 4.4339 5.84848 4.61663 5.92417C4.79936 5.99986 5.00042 6.01966 5.1944 5.98107C5.38838 5.94249 5.56657 5.84725 5.70642 5.7074C5.84627 5.56754 5.94151 5.38936 5.9801 5.19538C6.01868 5.0014 5.99888 4.80033 5.92319 4.61761C5.8475 4.43488 5.71933 4.2787 5.55488 4.16882ZM18.4437 19.8318C18.6082 19.9416 18.8015 20.0003 18.9993 20.0003C19.2645 20.0003 19.5189 19.8949 19.7064 19.7074C19.894 19.5199 19.9993 19.2655 19.9993 19.0003C19.9993 18.8025 19.9407 18.6092 19.8308 18.4447C19.7209 18.2803 19.5647 18.1521 19.382 18.0764C19.1993 18.0007 18.9982 17.9809 18.8042 18.0195C18.6102 18.0581 18.4321 18.1533 18.2922 18.2932C18.1524 18.433 18.0571 18.6112 18.0185 18.8052C17.9799 18.9992 17.9997 19.2002 18.0754 19.383C18.1511 19.5657 18.2793 19.7219 18.4437 19.8318Z",fill:"currentColor"}))};const fe=function(){var e=N(),t=e.selectedTool,n=e.setSelectedTool;return i().createElement("div",{className:"plintus-vertical-toolbar"},[{id:"line",label:"Рисование",icon:"uil-edit-alt"},{id:"select",label:"Редактировать",icon:"uil-vector-square"},{id:"arc",label:"Скругление",icon:"uil-circle"},{id:"delete",label:"Удаление",icon:"uil-trash-alt"}].map(function(e){return i().createElement("button",{key:e.id,type:"button",className:"plintus-vertical-tool-button ".concat(t===e.id?"active":""),onClick:function(){return n(e.id)},title:e.label},"arc"===e.id?i().createElement(ue,null):i().createElement("i",{className:"fs-28 uil ".concat(e.icon)}),i().createElement("span",{className:"plintus-vertical-tool-button-text"},e.label))}))},pe=function(e){var t=e.elements,n=x(t.reduce(function(e,t){return t.start&&t.end?e+v(t.start,t.end):t.length?e+t.length:e},0));return i().createElement("div",{className:"line-properties"},i().createElement("h4",null,"Свойства линии"),t.length>1&&i().createElement("p",{className:"line-count"},"Линий: ",t.length),i().createElement("div",{className:"property-item"},i().createElement("label",null,"Длина:"),i().createElement("span",{className:"property-value"},n)))};function he(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return me(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?me(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const ye=function(e){var t=e.element,n=N().updateElement,o=he((0,r.useState)(t.radius?Math.round(b(t.radius)):5),2),a=o[0],s=o[1],l=he((0,r.useState)(t.angle?Math.round(t.angle):90),2),c=l[0],d=l[1];(0,r.useEffect)(function(){if(t.radius){var e=Math.round(b(t.radius));s(e)}void 0!==t.angle&&d(Math.round(t.angle))},[t.radius,t.angle]);var u=x((t.radius||0)*(c*Math.PI/180));return i().createElement("div",{className:"arc-properties"},i().createElement("h4",null,"Свойства дуги"),i().createElement("div",{className:"property-item"},i().createElement("label",{htmlFor:"arc-radius"},"Радиус (мм):"),i().createElement("input",{id:"arc-radius",type:"number",min:"1",step:"1",value:a,onChange:function(e){var r=parseFloat(e.target.value);!isNaN(r)&&r>0&&(s(r),n(t.id,{radius:g(r)}))},className:"property-input"})),i().createElement("div",{className:"property-item"},i().createElement("label",{htmlFor:"arc-angle"},"Угол (°):"),i().createElement("input",{id:"arc-angle",type:"number",min:"0",max:"360",step:"1",value:c,onChange:function(e){var r=parseFloat(e.target.value);!isNaN(r)&&r>=0&&r<=360&&(d(r),n(t.id,{angle:r}))},className:"property-input"})),i().createElement("div",{className:"property-item"},i().createElement("label",null,"Длина:"),i().createElement("span",{className:"property-value"},u)))};function ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const ge=function(e){var t,n,o=e.element,a=N().updateFilletRadius,s=(t=(0,r.useState)(o.radius?Math.round(b(o.radius)):3),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,n)||function(e,t){if(e){if("string"==typeof e)return ve(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ve(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=s[0],c=s[1];return(0,r.useEffect)(function(){if(o.radius){var e=Math.round(b(o.radius));c(e)}},[o.radius]),i().createElement("div",{className:"fillet-properties"},i().createElement("h4",null,"Свойства скругления"),i().createElement("div",{className:"property-item"},i().createElement("label",{htmlFor:"fillet-radius"},"Скругление (мм):"),i().createElement("input",{id:"fillet-radius",type:"number",min:"1",step:"1",value:l,onChange:function(e){var t=parseFloat(e.target.value);!isNaN(t)&&t>0&&(c(t),a(o.id,t))},className:"property-input"})))};var be=n(38),xe={};xe.styleTagTransform=U(),xe.setAttributes=B(),xe.insert=W().bind(null,"head"),xe.domAPI=F(),xe.insertStyleElement=Z(),z()(be.A,xe),be.A&&be.A.locals&&be.A.locals;const Ee=function(e){var t=e.elements,n=N(),r=n.deleteSelectedElements,o=n.debugNumbersVisible,a=n.toggleDebugNumbersVisible,s=N(function(e){return e.elements}),l=t.filter(function(e){return"line"===e.type}),c=t.filter(function(e){return"arc"===e.type}),d=t.filter(function(e){return"fillet"===e.type}),u=function(e){return"line"===e.type?e.start&&e.end?v(e.start,e.end):e.length?e.length:0:"arc"===e.type?(e.radius||0)*((e.angle||90)*Math.PI/180):"fillet"===e.type?(e.arc&&e.arc.radius||e.radius||0)*((e.arc&&e.arc.angle||0)*Math.PI/180):0},f=s.filter(function(e){return"line"===e.type}),p=s.filter(function(e){return"fillet"===e.type}),h=x(f.reduce(function(e,t){return e+u(t)},0)),m=p.length;return i().createElement("div",{className:"plintus-properties-panel"},i().createElement("div",{className:"panel-header"},t.length>0&&i().createElement("button",{onClick:function(){r()},className:"delete-button"},"Удалить")),i().createElement("div",{className:"panel-content"},i().createElement("div",{className:"properties-summary"},i().createElement("h4",null,"Сводка"),i().createElement("div",{className:"summary-item"},i().createElement("span",{className:"summary-label"},"Общая длина линий:"),i().createElement("span",{className:"summary-value"},h)),i().createElement("div",{className:"summary-item"},i().createElement("span",{className:"summary-label"},"Количество скруглений:"),i().createElement("span",{className:"summary-value"},m))),i().createElement("div",{className:"properties-section"},i().createElement("h3",{className:"properties-section-title"},0===t.length?"Свойства":"Свойства (".concat(t.length," выбрано)"))),i().createElement("div",{className:"properties-elements-list"},i().createElement("h4",null,"Выбранные элементы:"),t.length>0?i().createElement("ul",{className:"properties-elements-list-items"},t.map(function(e,t){var n,r=x(u(e));return i().createElement("li",{key:e.id,className:"properties-element-item"},i().createElement("span",{className:"element-type-badge"},{line:"Линия",arc:"Дуга",fillet:"Скругление"}[n=e.type]||n),i().createElement("span",{className:"element-id"},"#",t+1),i().createElement("span",{className:"element-length"},r))})):i().createElement("p",{className:"properties-empty-state"},"Элементы не выбраны")),l.length>0&&i().createElement(pe,{elements:l}),1===c.length&&i().createElement(ye,{element:c[0]}),1===d.length&&i().createElement(ge,{element:d[0]}),i().createElement("div",{className:"debug-controls",style:{marginTop:"20px",paddingTop:"20px",borderTop:"1px solid #ddd"}},i().createElement("button",{type:"button",onClick:function(e){e.preventDefault(),e.stopPropagation(),a()},className:o?"active":"",style:{width:"100%",padding:"10px",backgroundColor:o?"#0073aa":"#f0f0f0",color:o?"#fff":"#333",border:"1px solid #ccc",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},title:"Показать/скрыть номера точек для отладки"},o?"✓ ":"","Отладочные номера"))))};var we,Se;function Pe(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function o(n,r,i,o){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return Ce(c,"_invoke",function(n,r,i){var o,s,l,c=0,d=i||[],u=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return o=t,s=0,l=e,f.n=n,a}};function p(n,r){for(s=n,l=r,t=0;!u&&c&&!i&&t<d.length;t++){var i,o=d[t],p=f.p,h=o[2];n>3?(i=h===r)&&(l=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=p&&((i=n<2&&p<o[1])?(s=0,f.v=r,f.n=o[1]):p<h&&(i=n<3||o[0]>r||r>h)&&(o[4]=n,o[5]=r,f.n=h,s=0))}if(i||n>1)return a;throw u=!0,r}return function(i,d,h){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&p(d,h),s=d,l=h;(t=s<2?e:l)||!u;){o||(s?s<3?(s>1&&(f.n=-1),p(s,l)):f.n=l:f.v=l);try{if(c=2,o){if(s||(i="next"),t=o[i]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=o.return)&&t.call(o),s<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),s=1);o=e}else if((t=(u=f.n<0)?l:n.call(r,f))!==a)break}catch(t){o=e,s=1,l=t}finally{c=1}}return{value:t,done:u}}}(n,i,o),!0),c}var a={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var d=[][r]?t(t([][r]())):(Ce(t={},r,function(){return this}),t),u=c.prototype=s.prototype=Object.create(d);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Ce(e,i,"GeneratorFunction")),e.prototype=Object.create(u),e}return l.prototype=c,Ce(u,"constructor",c),Ce(c,"constructor",l),l.displayName="GeneratorFunction",Ce(c,i,"GeneratorFunction"),Ce(u),Ce(u,i,"Generator"),Ce(u,r,function(){return this}),Ce(u,"toString",function(){return"[object Generator]"}),(Pe=function(){return{w:o,m:f}})()}function Ce(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}Ce=function(e,t,n,r){function o(t,n){Ce(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},Ce(e,t,n,r)}function Ie(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function Te(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){Ie(o,r,i,a,s,"next",e)}function s(e){Ie(o,r,i,a,s,"throw",e)}a(void 0)})}}var je=(null===(we=window.plintusEditor)||void 0===we?void 0:we.apiUrl)||"/wp-json/plintus-paperjs/v1/",Me=(null===(Se=window.plintusEditor)||void 0===Se?void 0:Se.nonce)||"";function Oe(){return(Oe=Te(Pe().m(function e(t){var n,r;return Pe().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(je,"profiles/").concat(t,"/data"),{method:"GET",headers:{"X-WP-Nonce":Me}});case 1:if((n=e.v).ok){e.n=2;break}throw new Error("Failed to load profile data");case 2:return e.n=3,n.json();case 3:return e.a(2,e.v);case 4:return e.p=4,r=e.v,console.error("Error loading profile data:",r),e.a(2,null)}},e,null,[[0,4]])}))).apply(this,arguments)}function ke(){return(ke=Te(Pe().m(function e(t,n){var r,i;return Pe().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(je,"profiles/").concat(t,"/data"),{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":Me},body:JSON.stringify({data:n})});case 1:if((r=e.v).ok){e.n=2;break}throw new Error("Failed to save profile data");case 2:return e.n=3,r.json();case 3:return e.a(2,e.v);case 4:return e.p=4,i=e.v,console.error("Error saving profile data:",i),e.a(2,null)}},e,null,[[0,4]])}))).apply(this,arguments)}var Ae=n(912),De={};De.styleTagTransform=U(),De.setAttributes=B(),De.insert=W().bind(null,"head"),De.domAPI=F(),De.insertStyleElement=Z(),z()(Ae.A,De),Ae.A&&Ae.A.locals&&Ae.A.locals;const Ne=function(){var e,t=N(),n=t.selectedElements,o=t.loadProfile,a=null===(e=window.plintusEditor)||void 0===e?void 0:e.profileId;return(0,r.useEffect)(function(){a&&function(e){return Oe.apply(this,arguments)}(a).then(function(e){e&&e.data&&o(e.data)})},[a,o]),(0,r.useEffect)(function(){var e=setInterval(function(){var e=N.getState(),t=e.elements,n=e.grid,r=e.viewbox;a&&t.length>=0&&function(e,t){ke.apply(this,arguments)}(a,{elements:t,grid:n,viewbox:r})},5e3);return function(){return clearInterval(e)}},[a]),i().createElement("div",{className:"plintus-editor"},i().createElement(le,null),i().createElement("div",{className:"plintus-editor-content"},i().createElement(fe,null),i().createElement("div",{className:"plintus-editor-canvas-wrapper"},i().createElement(re,null)),i().createElement(Ee,{elements:n})))};var Le=document.getElementById("plintus-profile-editor-paperjs-root");if(Le)try{o.createRoot(Le).render(i().createElement(Ne,null))}catch(e){console.error("Error rendering React app:",e)}})();