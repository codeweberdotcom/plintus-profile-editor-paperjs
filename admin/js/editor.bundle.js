/*! For license information please see editor.bundle.js.LICENSE.txt */
(()=>{"use strict";var e={38(e,t,n){n.d(t,{A:()=>s});var r=n(601),i=n.n(r),o=n(314),a=n.n(o)()(i());a.push([e.id,".plintus-properties-panel {\n    width: 300px;\n    height: 100%;\n    background: #fff;\n    border-left: 1px solid #ddd;\n    display: flex;\n    flex-direction: column;\n    overflow-y: auto;\n    flex-shrink: 0; /* Prevent panel from shrinking */\n}\n\n.panel-header {\n    padding: 15px;\n    border-bottom: 1px solid #ddd;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n}\n\n.panel-header h3 {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n}\n\n.delete-button {\n    padding: 6px 12px;\n    background: #dc3545;\n    color: #fff;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n}\n\n.delete-button:hover {\n    background: #c82333;\n}\n\n.panel-content {\n    padding: 15px;\n    flex: 1;\n}\n\n.properties-elements-list {\n    margin-bottom: 20px;\n}\n\n.properties-elements-list h4 {\n    margin: 0 0 10px 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: #555;\n}\n\n.properties-elements-list-items {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n}\n\n.properties-element-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px;\n    margin-bottom: 4px;\n    background: #f5f5f5;\n    border-radius: 4px;\n    font-size: 13px;\n}\n\n.element-type-badge {\n    background: #0073aa;\n    color: #fff;\n    padding: 2px 6px;\n    border-radius: 3px;\n    font-size: 11px;\n    font-weight: 600;\n    text-transform: uppercase;\n}\n\n.element-id {\n    color: #666;\n    font-weight: 500;\n}\n\n.element-length {\n    margin-left: auto;\n    color: #333;\n    font-weight: 600;\n}\n\n.arc-properties,\n.line-properties,\n.fillet-properties {\n    margin-top: 20px;\n    padding: 15px;\n    background: #f9f9f9;\n    border-radius: 4px;\n    border: 1px solid #e0e0e0;\n}\n\n.arc-properties h4,\n.line-properties h4,\n.fillet-properties h4 {\n    margin: 0 0 15px 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: #333;\n}\n\n.property-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n    padding: 8px 0;\n    border-bottom: 1px solid #e0e0e0;\n}\n\n.property-item:last-child {\n    border-bottom: none;\n    margin-bottom: 0;\n}\n\n.property-item label {\n    font-size: 13px;\n    color: #666;\n    font-weight: 500;\n}\n\n.property-value {\n    font-size: 13px;\n    color: #333;\n    font-weight: 600;\n}\n\n.property-input {\n    width: 80px;\n    padding: 4px 8px;\n    border: 1px solid #ccc;\n    border-radius: 3px;\n    font-size: 13px;\n    text-align: right;\n}\n\n.property-input:focus {\n    outline: none;\n    border-color: #0073aa;\n    box-shadow: 0 0 0 2px rgba(0, 115, 170, 0.1);\n}\n\n.properties-empty-state {\n    color: #999;\n    font-size: 13px;\n    font-style: italic;\n    margin: 10px 0;\n    padding: 10px;\n    text-align: center;\n}\n\n.properties-summary {\n    margin-bottom: 20px;\n    padding: 15px;\n    background: #f9f9f9;\n    border-radius: 4px;\n    border: 1px solid #e0e0e0;\n}\n\n.properties-summary h4 {\n    margin: 0 0 15px 0;\n    font-size: 14px;\n    font-weight: 600;\n    color: #333;\n}\n\n.properties-section {\n    margin-top: 20px;\n    margin-bottom: 15px;\n}\n\n.properties-section-title {\n    margin: 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: #333;\n}\n\n.summary-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 10px;\n    padding: 8px 0;\n    border-bottom: 1px solid #e0e0e0;\n}\n\n.summary-item:last-child {\n    border-bottom: none;\n    margin-bottom: 0;\n}\n\n.summary-label {\n    font-size: 13px;\n    color: #666;\n    font-weight: 500;\n}\n\n.summary-value {\n    font-size: 13px;\n    color: #333;\n    font-weight: 600;\n}\n\n\n\n\n",""]);const s=a},47(e,t,n){n.d(t,{A:()=>s});var r=n(601),i=n.n(r),o=n(314),a=n.n(o)()(i());a.push([e.id,".plintus-vertical-toolbar {\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n    padding: 10px;\n    background: #fff;\n    border-right: 1px solid #ddd;\n    width: 120px;\n    gap: 5px;\n}\n\n.plintus-vertical-tool-button {\n    width: 100%;\n    min-height: 50px;\n    border: 1px solid #ddd;\n    background: #fff;\n    cursor: pointer;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    padding: 8px 5px;\n    margin: 0;\n    transition: all 0.2s;\n    gap: 4px;\n}\n\n.plintus-vertical-tool-button:hover {\n    background: #f0f0f0;\n    border-color: #0073aa;\n}\n\n.plintus-vertical-tool-button.active {\n    background: #0073aa;\n    color: #fff;\n    border-color: #0073aa;\n}\n\n.plintus-vertical-tool-button-text {\n    font-size: 12px;\n    line-height: 1.2;\n    text-align: center;\n    white-space: nowrap;\n}\n\n.plintus-vertical-tool-button i {\n    font-size: 24px;\n}\n\n",""]);const s=a},52(e,t,n){n.d(t,{A:()=>s});var r=n(601),i=n.n(r),o=n(314),a=n.n(o)()(i());a.push([e.id,".canvas-editor {\n    width: 100%;\n    height: 100%;\n    position: relative;\n    overflow: hidden;\n}\n\n#plintus-paperjs-canvas {\n    display: block;\n    width: 100%;\n    height: 100%;\n    /* Размеры устанавливаются через атрибуты width и height, не через CSS */\n}\n\n",""]);const s=a},56(e,t,n){e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72(e){var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},a=[],s=0;s<e.length;s++){var l=e[s],c=r.base?l[0]+r.base:l[0],d=o[c]||0,u="".concat(c," ").concat(d);o[c]=d+1;var f=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==f)t[f].references++,t[f].updater(p);else{var h=i(p,r);r.byIndex=s,t.splice(s,0,{identifier:u,updater:h,references:1})}a.push(u)}return a}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var o=r(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<o.length;a++){var s=n(o[a]);t[s].references--}for(var l=r(e,i),c=0;c<o.length;c++){var d=n(o[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}o=l}}},113(e){e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},162(e,t,n){var r=n(594),i=n(888),o="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=i.useSyncExternalStore,s=r.useRef,l=r.useEffect,c=r.useMemo,d=r.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,r,i){var u=s(null);if(null===u.current){var f={hasValue:!1,value:null};u.current=f}else f=u.current;u=c(function(){function e(e){if(!l){if(l=!0,a=e,e=r(e),void 0!==i&&f.hasValue){var t=f.value;if(i(t,e))return s=t}return s=e}if(t=s,o(a,e))return t;var n=r(e);return void 0!==i&&i(t,n)?(a=e,t):(a=e,s=n)}var a,s,l=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,r,i]);var p=a(e,u[0],u[1]);return l(function(){f.hasValue=!0,f.value=p},[p]),d(p),p}},206(e){e.exports=ReactDOM},242(e,t,n){e.exports=n(162)},314(e){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,r,i,o){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(r)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);r&&a[d[0]]||(void 0!==o&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=o),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},338(e,t,n){var r=n(206);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},493(e,t,n){var r=n(594),i="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},o=r.useState,a=r.useEffect,s=r.useLayoutEffect,l=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!i(e,n)}catch(e){return!0}}var d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=o({inst:{value:n,getSnapshot:t}}),i=r[0].inst,d=r[1];return s(function(){i.value=n,i.getSnapshot=t,c(i)&&d({inst:i})},[e,n,t]),a(function(){return c(i)&&d({inst:i}),e(function(){c(i)&&d({inst:i})})},[e]),l(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:d},540(e){e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},594(e){e.exports=React},601(e){e.exports=function(e){return e[1]}},659(e){var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},825(e){e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},888(e,t,n){e.exports=n(493)},912(e,t,n){n.d(t,{A:()=>s});var r=n(601),i=n.n(r),o=n(314),a=n.n(o)()(i());a.push([e.id,".plintus-editor {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    background: #f5f5f5;\n}\n\n.plintus-editor-content {\n    flex: 1;\n    position: relative;\n    overflow: hidden;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: row;\n}\n\n.plintus-editor-canvas-wrapper {\n    flex: 1;\n    height: 100%;\n    position: relative;\n    min-width: 0; /* Allows flex item to shrink below its content size */\n}\n\n\n\n\n",""]);const s=a},925(e,t,n){n.d(t,{A:()=>s});var r=n(601),i=n.n(r),o=n(314),a=n.n(o)()(i());a.push([e.id,".plintus-toolbar {\n    display: flex;\n    align-items: center;\n    padding: 10px;\n    background: #fff;\n    border-bottom: 1px solid #ddd;\n    justify-content: space-between;\n}\n\n.plintus-toolbar-section {\n    display: flex;\n    gap: 0;\n    align-items: center;\n}\n\n.plintus-toolbar-section-right {\n    margin-left: auto;\n}\n\n.plintus-tool-button {\n    width: 36px;\n    height: 36px;\n    border: 1px solid #ddd;\n    background: #fff;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 0;\n    margin: 0;\n    transition: all 0.2s;\n}\n\n.plintus-tool-button:hover {\n    background: #f0f0f0;\n    border-color: #0073aa;\n}\n\n.plintus-tool-button.active {\n    background: #0073aa;\n    color: #fff;\n    border-color: #0073aa;\n}\n\n.plintus-toolbar button {\n    width: 36px;\n    height: 36px;\n    border: 1px solid #ddd;\n    background: #fff;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 0;\n    margin: 0;\n    transition: all 0.2s;\n}\n\n.plintus-toolbar button:hover {\n    background: #f0f0f0;\n    border-color: #0073aa;\n}\n\n.plintus-toolbar button.active {\n    background: #0073aa;\n    color: #fff;\n    border-color: #0073aa;\n}\n\n.plintus-toolbar button i {\n    font-size: 18px;\n}\n\n\n\n\n",""]);const s=a}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var r=n(594),i=n.n(r),o=n(338);const a=e=>{let t;const n=new Set,r=(e,r)=>{const i="function"==typeof e?e(t):e;if(!Object.is(i,t)){const e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,o={setState:r,getState:i,getInitialState:()=>a,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{"production"!=={NODE_ENV:"production"}.MODE&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},a=t=e(r,i,o);return o};var s=n(242);const{useDebugValue:l}=r,{useSyncExternalStoreWithSelector:c}=s;let d=!1;const u=e=>e,f=e=>{"production"!=={NODE_ENV:"production"}.MODE&&"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?(e=>e?a(e):a)(e):e,n=(e,n)=>function(e,t=u,n){"production"!=={NODE_ENV:"production"}.MODE&&n&&!d&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),d=!0);const r=c(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return l(r),r}(t,e,n);return Object.assign(n,t),n};function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){m(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function m(e,t,n){return(t=function(e){var t=function(e){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function g(e){return 3.779527559*e}function b(e){return e/3.779527559}function x(e){var t=b(e);return"".concat(Math.round(10*t)/10," мм")}function E(e,t){return Math.round(e/t)*t}function w(e,t){return{x:E(e.x,t),y:E(e.y,t)}}function S(e,t){return Math.abs(t.x-e.x)>Math.abs(t.y-e.y)?{x:t.x,y:e.y}:{x:e.x,y:t.y}}function P(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,i=n.x-t.x,o=n.y-t.y,a=Math.sqrt(i*i+o*o);if(0===a)return!1;var s=Math.max(0,Math.min(1,((e.x-t.x)*i+(e.y-t.y)*o)/(a*a))),l=t.x+s*i,c=t.y+s*o;return Math.sqrt(Math.pow(e.x-l,2)+Math.pow(e.y-c,2))<r}function I(e){var t=e.end.x-e.start.x,n=e.end.y-e.start.y,r=Math.sqrt(t*t+n*n);return 0===r?{x:0,y:0}:{x:t/r,y:n/r}}function T(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=[{point:e.start,line1End:!0,line2End:!1},{point:e.end,line1End:!0,line2End:!1},{point:t.start,line1End:!1,line2End:!0},{point:t.end,line1End:!1,line2End:!0}],i=0;i<r.length;i++)for(var o=i+1;o<r.length;o++)if(v(r[i].point,r[o].point)<n)return y(y({},r[i].point),{},{line1End:r[i].line1End||r[o].line1End,line2End:r[i].line2End||r[o].line2End});return null}function j(e){return j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},j(e)}function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach(function(t){M(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function M(e,t,n){return(t=function(e){var t=function(e){if("object"!=j(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=j(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==j(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return A(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?A(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var N,D=(N=function(e,t){return{elements:[],selectedElements:[],selectedTool:"line",grid:{stepMM:1,snap:!0,visible:!0,showMajorLines:!1},dimensionsVisible:!0,orthogonalSnap:!0,viewbox:{x:0,y:0,width:800,height:400},isDrawing:!1,currentLineStart:null,setSelectedTool:function(t){return e({selectedTool:t,selectedElements:[]})},addElement:function(t){return e(function(e){return{elements:[].concat(k(e.elements),[C(C({},t),{},{id:"element-".concat(Date.now(),"-").concat(Math.random())})])}})},updateElement:function(t,n){return e(function(e){return{elements:e.elements.map(function(e){return e.id===t?C(C({},e),n):e})}})},deleteElement:function(t){return e(function(e){return{elements:e.elements.filter(function(e){return e.id!==t}),selectedElements:e.selectedElements.filter(function(e){return e.id!==t})}})},deleteSelectedElements:function(){return e(function(e){var t=new Set(e.selectedElements.map(function(e){return e.id}));return{elements:e.elements.filter(function(e){return!t.has(e.id)}),selectedElements:[]}})},selectElement:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e(function(e){return t?n?e.selectedElements.some(function(e){return e.id===t.id})?{selectedElements:e.selectedElements.filter(function(e){return e.id!==t.id})}:{selectedElements:[].concat(k(e.selectedElements),[t])}:{selectedElements:[t]}:{selectedElements:[]}})},loadProfile:function(t){return e({elements:t.elements||[],grid:t.grid||{stepMM:1,snap:!0,visible:!0,showMajorLines:!1},viewbox:t.viewbox||{x:0,y:0,width:800,height:400}})},setCurrentLineStart:function(t){return e({currentLineStart:t})},setIsDrawing:function(t){return e({isDrawing:t})},toggleDimensionsVisible:function(){return e(function(e){return{dimensionsVisible:!e.dimensionsVisible}})},toggleMajorLines:function(){return e(function(e){return{grid:C(C({},e.grid),{},{showMajorLines:!e.grid.showMajorLines})}})},toggleOrthogonalSnap:function(){return e(function(e){return{orthogonalSnap:!e.orthogonalSnap}})},updateFilletRadius:function(t,n){return e(function(e){var r=e.elements.find(function(e){return e.id===t&&"fillet"===e.type});if(!r)return e;var i,o=g(n),a=r.connection,s=r.line1Direction,l=r.line2Direction,c=r.angle1,d=r.angle2,u=r.line1Id,f=r.line2Id,p=r.line1EndTruncated,h=r.line2EndTruncated,y={x:a.x+s.x*o,y:a.y+s.y*o},m={x:a.x+l.x*o,y:a.y+l.y*o},b=s,x=l,E={x:-b.y,y:b.x},w={x:-x.y,y:x.x},S=b.x+x.x,P=b.y+x.y,I=Math.sqrt(S*S+P*P),T=I>1e-4?{x:S/I,y:P/I}:{x:-b.y,y:b.x},j=E.x*T.x+E.y*T.y>0?E:{x:-E.x,y:-E.y},O=w.x*T.x+w.y*T.y>0?w:{x:-w.x,y:-w.y},M=m.x-y.x,k=m.y-y.y,A=j.x*O.y-j.y*O.x;if(Math.abs(A)<1e-4){var N=Math.abs(d-c);N>180&&(N=360-N);var D=N*Math.PI/180,L=D>1e-4?o/Math.sin(D/2):o;i={x:a.x+T.x*L,y:a.y+T.y*L}}else{var F=(M*O.y-k*O.x)/A;i={x:y.x+F*j.x,y:y.y+F*j.y}}var z=Math.atan2(y.y-i.y,y.x-i.x),R=Math.atan2(m.y-i.y,m.x-i.x)-z;R>Math.PI?R-=2*Math.PI:R<-Math.PI&&(R+=2*Math.PI);var W=z*(180/Math.PI);W>180&&(W-=360),W<-180&&(W+=360);var J=Math.abs(R)*(180/Math.PI),V=e.elements.find(function(e){return e.id===u}),q=e.elements.find(function(e){return e.id===f});if(!V||!q)return e;var B=V.length||v(V.start,V.end),U=q.length||v(q.start,q.end),_=p,G=h;if(fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:127",message:"updateFilletRadius truncation check",data:{line1EndTruncated:p,line2EndTruncated:h,line1:{start:V.start,end:V.end},line2:{start:q.start,end:q.end},connection:a},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"A"})}).catch(function(){}),void 0===_||void 0===G){var H=v(a,V.start),$=v(a,V.end),X=v(a,q.start),K=v(a,q.end);_=$<H,G=K<X,fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:138",message:"updateFilletRadius fallback calculation",data:{distToLine1Start:H,distToLine1End:$,distToLine2Start:X,distToLine2End:K,shouldTruncateLine1End:_,shouldTruncateLine2End:G},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"A"})}).catch(function(){})}return{elements:e.elements.map(function(e){if(e.id===t){var n=C(C({},e),{},{radius:o,arc:{center:i,radius:o,startAngle:W,angle:J},arcStartPoint:y,arcEndPoint:m,line1EndTruncated:_,line2EndTruncated:G});return fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:150",message:"updateFilletRadius fillet update",data:{filletId:t,newRadius:o,arcStartPoint:y,arcEndPoint:m,shouldTruncateLine1End:_,shouldTruncateLine2End:G},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"B"})}).catch(function(){}),n}if(e.id===u){var r=_?{end:y,length:B}:{start:y,length:B};return fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:162",message:"updateFilletRadius line1 update",data:{line1Id:u,update:r,shouldTruncateLine1End:_,arcStartPoint:y,originalLine1Length:B},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"B"})}).catch(function(){}),C(C({},e),r)}if(e.id===f){var a=G?{end:m,length:U}:{start:m,length:U};return fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"useEditorStore.js:173",message:"updateFilletRadius line2 update",data:{line2Id:f,update:a,shouldTruncateLine2End:G,arcEndPoint:m,originalLine2Length:U},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"B"})}).catch(function(){}),C(C({},e),a)}return e})}})}}})?f(N):f,L=n(72),F=n.n(L),z=n(825),R=n.n(z),W=n(659),J=n.n(W),V=n(56),q=n.n(V),B=n(540),U=n.n(B),_=n(113),G=n.n(_),H=n(52),$={};function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach(function(t){Y(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Y(e,t,n){return(t=function(e){var t=function(e){if("object"!=X(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=X(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==X(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Z(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=te(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||te(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e,t){if(e){if("string"==typeof e)return ne(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ne(e,t):void 0}}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}$.styleTagTransform=G(),$.setAttributes=q(),$.insert=J().bind(null,"head"),$.domAPI=R(),$.insertStyleElement=U(),F()(H.A,$),H.A&&H.A.locals&&H.A.locals;const re=function(){var e=(0,r.useRef)(null),t=(0,r.useRef)(null),n=(0,r.useRef)(null),o=ee((0,r.useState)(null),2),a=o[0],s=o[1],l=ee((0,r.useState)({width:800,height:400}),2),c=l[0],d=l[1],u=ee((0,r.useState)(null),2),f=u[0],p=u[1],h=ee((0,r.useState)(null),2),y=h[0],m=h[1],b=D(),E=b.elements,j=b.selectedElements,O=b.selectedTool,C=b.grid,M=b.dimensionsVisible,k=b.orthogonalSnap,A=b.currentLineStart,N=b.isDrawing,L=b.setCurrentLineStart,F=b.setIsDrawing,z=b.addElement,R=b.deleteElement,W=b.selectElement,J=b.deleteSelectedElements,V=b.updateElement,q=g(C.stepMM),B=D(function(e){return e.viewbox});(0,r.useEffect)(function(){var e=function(){if(t.current){var e=t.current.getBoundingClientRect();d({width:e.width,height:e.height})}};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}},[]),(0,r.useEffect)(function(){if(e.current){if("undefined"==typeof paper){var t=setInterval(function(){"undefined"!=typeof paper&&(clearInterval(t),r())},100);return function(){return clearInterval(t)}}return r(),function(){n.current&&n.current.remove()}}function r(){if(e.current){var t=e.current,r=c.width||B.width,i=c.height||B.height;t.width=r,t.height=i;var o=new paper.PaperScope;o.setup(t),o.activate(),o.view.scale(2,new paper.Point(r/2,i/2)),n.current=o,s(o.project)}}},[]),(0,r.useEffect)(function(){if(e.current&&n.current){var t=e.current,r=c.width||B.width,i=c.height||B.height;if(t.width!==r||t.height!==i){t.width=r,t.height=i;var o=n.current;o.activate(),o.view.viewSize=new paper.Size(r,i),o.view.draw()}}},[c.width,c.height,B.width,B.height]),(0,r.useEffect)(function(){if(console.log("useEffect for rendering called, selectedTool:",O),a&&n.current){var e=n.current;e.activate(),e.project.clear(),C.visible&&U(e,q,C.showMajorLines),E.filter(function(e){return"fillet"===e.type});var t=new Set;j.forEach(function(e){"fillet"===e.type&&(e.line1Id&&t.add(e.line1Id),e.line2Id&&t.add(e.line2Id))});var r=H(E);E.forEach(function(n){var i=j.some(function(e){return e.id===n.id});if("line"===n.type){var o=t.has(n.id);$(e,n,i||o,!1,null,r)}else"arc"===n.type?X(e,n,i):"fillet"===n.type&&K(e,n,i,E,r)}),"arc"===O&&G(E).forEach(function(e,t){var n=new paper.Path.Circle({center:[e.point.x,e.point.y],radius:8,fillColor:"#ff6600",strokeColor:"#fff",strokeWidth:2});n.data={type:"connectionPoint",connectionPoint:e,index:t},n.bringToFront()}),e.view.draw()}else console.log("Paper project not ready")},[E,j,C,M,a,q,O]),(0,r.useEffect)(function(){if(a&&n.current){var t=n.current;t.activate();var r=new paper.Tool;return r.onMouseDown=function(e){var t={x:e.point.x,y:e.point.y},n=w(t,q);if("line"===O)if(A){var r=w(k?S(A,n):n,q);z({type:"line",start:A,end:r,length:v(A,r)}),L(r),F(!0)}else L(n),F(!0);else if("select"===O){var i,o=null,a=Z(j);try{for(a.s();!(i=a.n()).done;){var s=i.value;if("line"===s.type){var l=v(t,s.start),c=v(t,s.end);if(l<8){o={elementId:s.id,pointType:"start",point:s.start};break}if(c<8){o={elementId:s.id,pointType:"end",point:s.end};break}}}}catch(e){a.e(e)}finally{a.f()}if(o){var d=_(o.elementId,o.pointType,o.point,E,j);p(d)}else{var u=E.find(function(e){if("fillet"===e.type){var n=v(t,e.arc.center);return Math.abs(n-e.arc.radius)<10}return!1});u||(u=E.find(function(e){if("line"===e.type)return P(t,e.start,e.end,10);if("arc"===e.type){var n=v(t,e.center);return Math.abs(n-e.radius)<10}return!1})),u?W(u,!0):W(null)}}else if("delete"===O){var f=E.find(function(e){if("line"===e.type)return P(t,e.start,e.end,10);if("arc"===e.type){var n=v(t,e.center);return Math.abs(n-e.radius)<10}if("fillet"===e.type){var r=v(t,e.arc.center),i=Math.abs(r-e.arc.radius)<10,o=E.find(function(t){return t.id===e.line1Id}),a=E.find(function(t){return t.id===e.line2Id}),s=!(!o||"line"!==o.type)&&P(t,o.start,o.end,10),l=!(!a||"line"!==a.type)&&P(t,a.start,a.end,10);return s||l||i}return!1});f?R(f.id):j.length>0&&J()}else if("arc"===O){fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:320",message:"arc mode click",data:{point:{x:t.x,y:t.y}},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"A"})}).catch(function(){});var h=E.find(function(e){if("fillet"===e.type){var n=v(t,e.arc.center);return Math.abs(n-e.arc.radius)<10}return!1}),y=E.find(function(e){if("arc"===e.type){var n=v(t,e.center);return Math.abs(n-e.radius)<10}return!1});if(fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:342",message:"fillet/arc check",data:{clickedFillet:!!h,clickedArc:!!y},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"B"})}).catch(function(){}),h)W(h);else if(y)W(y);else{var m=G(E);fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:349",message:"checking connection points",data:{connectionPointsCount:m.length,connectionPoints:m.map(function(e){return{point:{x:e.point.x,y:e.point.y},line1Id:e.line1.id,line2Id:e.line2.id}})},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"A"})}).catch(function(){});var g=m.find(function(e){var n=v(t,e.point);return fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:352",message:"distance check",data:{clickPoint:{x:t.x,y:t.y},cpPoint:{x:e.point.x,y:e.point.y},dist:n,threshold:10,withinRange:n<10},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"A"})}).catch(function(){}),n<10});if(fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:356",message:"connection point click result",data:{clickedConnection:!!g,clickedConnectionData:g?{point:{x:g.point.x,y:g.point.y},line1Id:g.line1.id,line2Id:g.line2.id}:null},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"A"})}).catch(function(){}),g){var b=D.getState(),x=b.elements.find(function(e){return e.id===g.line1.id}),I=b.elements.find(function(e){return e.id===g.line2.id});if(fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:362",message:"before createFilletAtCorner",data:{line1FromStore:!!x,line2FromStore:!!I,line1Id:g.line1.id,line2Id:g.line2.id},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"B"})}).catch(function(){}),x&&I&&"line"===x.type&&"line"===I.type){fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:363",message:"calling createFilletAtCorner",data:{line1Id:x.id,line2Id:I.id},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"B"})}).catch(function(){});try{ne(x,I),fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:363",message:"createFilletAtCorner completed",data:{},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"B"})}).catch(function(){})}catch(e){fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:363",message:"createFilletAtCorner error",data:{error:e.message,stack:e.stack},timestamp:Date.now(),sessionId:"debug-session",runId:"click-debug",hypothesisId:"B"})}).catch(function(){})}W(null)}}else W(null)}}},r.onMouseMove=function(n){var r={x:n.point.x,y:n.point.y},i=w(r,q),o=null,a=null;if("select"===O){var s,l=Z(j);try{for(l.s();!(s=l.n()).done;){var c=s.value;if("line"===c.type){var d=v(r,c.start),u=v(r,c.end);if(d<8){a={elementId:c.id,pointType:"start"},e.current&&(e.current.style.cursor="pointer");break}if(u<8){a={elementId:c.id,pointType:"end"},e.current&&(e.current.style.cursor="pointer");break}}}}catch(e){l.e(e)}finally{l.f()}a||(o=E.find(function(e){if("line"===e.type)return P(r,e.start,e.end,10);if("arc"===e.type){var t=v(r,e.center);return Math.abs(t-e.radius)<10}if("fillet"===e.type){var n=v(r,e.arc.center),i=Math.abs(n-e.arc.radius)<10,o=E.find(function(t){return t.id===e.line1Id}),a=E.find(function(t){return t.id===e.line2Id}),s=!(!o||"line"!==o.type)&&P(r,o.start,o.end,10),l=!(!a||"line"!==a.type)&&P(r,a.start,a.end,10);return s||l||i}return!1}),e.current&&!o&&(e.current.style.cursor="default"))}else"arc"===O&&(o=E.find(function(e){if("fillet"===e.type){var t=v(r,e.arc.center);return Math.abs(t-e.arc.radius)<10}if("arc"===e.type){var n=v(r,e.center);return Math.abs(n-e.radius)<10}return!1}));m(a),t.project.clear(),C.visible&&U(t,q,C.showMajorLines),E.filter(function(e){return"fillet"===e.type});var f=new Set;j.forEach(function(e){"fillet"===e.type&&(e.line1Id&&f.add(e.line1Id),e.line2Id&&f.add(e.line2Id))});var p=H(E);if(E.forEach(function(e){var n=j.some(function(t){return t.id===e.id}),r=o&&o.id===e.id;if("line"===e.type){var i=f.has(e.id);$(t,e,n||i,r,a,p)}else"arc"===e.type?X(t,e,n,r):"fillet"===e.type&&K(t,e,n||o&&o.id===e.id,E,p)}),"arc"===O&&G(E).forEach(function(e,t){var n=new paper.Path.Circle({center:[e.point.x,e.point.y],radius:8,fillColor:"#ff6600",strokeColor:"#fff",strokeWidth:2});n.data={type:"connectionPoint",connectionPoint:e,index:t},n.bringToFront()}),"line"===O){var h=i;if(A){F(!0),h=w(k?S(A,i):i,q),new paper.Path.Line({from:[A.x,A.y],to:[h.x,h.y],strokeColor:"#999",strokeWidth:2});var y=x(v(A,h)),g=(A.x+h.x)/2,b=(A.y+h.y)/2,I=45*Math.PI/180,T=g,M=b,N=g+15*Math.cos(I),D=b-15*Math.sin(I),L=N,z=D,R=N+40,W=D,J=z-3,V="#999",B=(Math.abs(A.x-h.x),new paper.Path.Line({from:[T,M],to:[N,D],strokeColor:V,strokeWidth:.5}),new paper.Path.Line({from:[L,z],to:[R,W],strokeColor:V,strokeWidth:.5}),new paper.PointText({point:[0,0],content:y,fillColor:V,fontSize:11})),_=B.bounds.width;B.remove();var Q=R-_;new paper.PointText({point:[Q,J],content:y,fillColor:V,fontSize:11})}new paper.Path.Circle({center:[h.x,h.y],radius:2.6,fillColor:"#0066cc",strokeColor:"#ffffff",strokeWidth:.5})}t.view.draw()},r.onMouseDrag=function(e){var n=D.getState();if(f&&Array.isArray(f)&&f.length>0&&"select"===n.selectedTool){var r={x:e.point.x,y:e.point.y},i=f[0],o=n.elements.find(function(e){return e.id===i.elementId});if(o&&"line"===o.type){var a;if(1===f.length){var s=o.end.x-o.start.x,l=o.end.y-o.start.y,c=Math.sqrt(s*s+l*l);if(c>0){var d=s/c,u=l/c,p="start"===i.pointType?o.start:o.end,h={x:r.x-p.x,y:r.y-p.y},y=h.x*d+h.y*u,m={x:p.x+y*d,y:p.y+y*u};a=w(m,q)}else a=w(r,q)}else a=w(r,q);f.forEach(function(e){var t=n.elements.find(function(t){return t.id===e.elementId});t&&"line"===t.type&&("start"===e.pointType?n.updateElement(t.id,{start:a,length:v(a,t.end)}):n.updateElement(t.id,{end:a,length:v(t.start,a)}))});var g=D.getState();t.project.clear(),g.grid.visible&&U(t,q,g.grid.showMajorLines),g.elements.filter(function(e){return"fillet"===e.type});var b=new Set;g.selectedElements.forEach(function(e){"fillet"===e.type&&(e.line1Id&&b.add(e.line1Id),e.line2Id&&b.add(e.line2Id))});var x=H(g.elements);g.elements.forEach(function(e){var n=g.selectedElements.some(function(t){return t.id===e.id});if("line"===e.type){var r=b.has(e.id);$(t,e,n||r,!1,null,x)}else"arc"===e.type?X(t,e,n,!1):"fillet"===e.type&&K(t,e,n,g.elements,x)}),t.view.draw()}}},r.onMouseUp=function(e){p(function(e){return e?null:e})},r.activate(),function(){r.remove()}}},[O,A,N,E,j,q,a,C,M,k,z,W,R,J,F,L,f,V,y]),(0,r.useEffect)(function(){var e=function(e){"Escape"===e.key&&N&&(L(null),F(!1))};return window.addEventListener("keydown",e),function(){return window.removeEventListener("keydown",e)}},[N]),(0,r.useEffect)(function(){var t=e.current;if(t){var n=function(){m(null),t.style.cursor="default"};return t.addEventListener("mouseleave",n),function(){t.removeEventListener("mouseleave",n)}}},[]);var U=function(e,t,n){var r=e.view,i=r.viewSize.width||c.width||B.width,o=r.viewSize.height||c.height||B.height,a=new paper.Layer;a.name="grid";for(var s=0;s<=i;s+=t){var l=new paper.Path.Line({from:[s,0],to:[s,o],strokeColor:"#e0e0e0",strokeWidth:.5});a.addChild(l)}for(var d=0;d<=o;d+=t){var u=new paper.Path.Line({from:[0,d],to:[i,d],strokeColor:"#e0e0e0",strokeWidth:.5});a.addChild(u)}if(n){for(var f=g(10),p=0;p<=i;p+=f){var h=new paper.Path.Line({from:[p,0],to:[p,o],strokeColor:"#999",strokeWidth:1});a.addChild(h)}for(var y=0;y<=o;y+=f){var m=new paper.Path.Line({from:[0,y],to:[i,y],strokeColor:"#999",strokeWidth:1});a.addChild(m)}}a.locked=!0},_=function(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=[{elementId:e,pointType:t}],s=r.find(function(t){return t.id===e});if(!s||"line"!==s.type)return a;var l,c=s[t],d=Z(i);try{var u=function(){var t=l.value;if(t.id===e||"line"!==t.type)return 1;v(c,t.start)<o&&(a.some(function(e){return e.elementId===t.id&&"start"===e.pointType})||a.push({elementId:t.id,pointType:"start"})),v(c,t.end)<o&&(a.some(function(e){return e.elementId===t.id&&"end"===e.pointType})||a.push({elementId:t.id,pointType:"end"}))};for(d.s();!(l=d.n()).done;)u()}catch(e){d.e(e)}finally{d.f()}return a},G=function(e){console.log("=== findAllConnectionPoints CALLED ===");var t=[],n=e.filter(function(e){return"line"===e.type});console.log("findAllConnectionPoints: looking for connections between",n.length,"lines");for(var r=0;r<n.length;r++)for(var i=function(){var i=n[r],a=n[o];if(e.find(function(e){return"fillet"===e.type&&(e.line1Id===i.id&&e.line2Id===a.id||e.line1Id===a.id&&e.line2Id===i.id)}))return 1;var s=T(i,a,10);console.log("Checking connection between lines",i.id,"and",a.id,":",s),s&&(console.log("Connection found!",s),t.push({point:s,line1:i,line2:a}))},o=r+1;o<n.length;o++)i();return console.log("findAllConnectionPoints: found",t.length,"connection points"),t},H=function(e){var t=new Map,n=1,r=e.filter(function(e){return"line"===e.type}),i=[];r.forEach(function(e){i.push({elementId:e.id,pointType:"start",point:e.start,line:e}),i.push({elementId:e.id,pointType:"end",point:e.end,line:e})});for(var o=function(){var e="".concat(i[a].elementId,":").concat(i[a].pointType);if(t.has(e))return 1;for(var r=[i[a]],o=a+1;o<i.length;o++)v(i[a].point,i[o].point)<10&&r.push(i[o]);var s=n++;r.forEach(function(e){var n="".concat(e.elementId,":").concat(e.pointType);t.set(n,s)})},a=0;a<i.length;a++)o();return t},$=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a="#000",s=2;if(n?(a="#0073aa",s=3):r&&(a="#0073aa",s=2),new paper.Path.Line({from:[t.start.x,t.start.y],to:[t.end.x,t.end.y],strokeColor:a,strokeWidth:s}).data={elementId:t.id,type:"line"},n&&"line"===t.type){var l=i&&i.elementId===t.id&&"start"===i.pointType,c=i&&i.elementId===t.id&&"end"===i.pointType;new paper.Path.Circle({center:[t.start.x,t.start.y],radius:2.6,fillColor:l?"#ff8800":"#0073aa",strokeColor:"#fff",strokeWidth:2}).data={elementId:t.id,pointType:"start",type:"linePoint"},new paper.Path.Circle({center:[t.end.x,t.end.y],radius:2.6,fillColor:c?"#ff8800":"#0073aa",strokeColor:"#fff",strokeWidth:2}).data={elementId:t.id,pointType:"end",type:"linePoint"}}if(o){var d="".concat(t.id,":start"),u="".concat(t.id,":end"),f=o.get(d),p=o.get(u);void 0!==f&&new paper.PointText({point:[t.start.x+8,t.start.y-8],content:"".concat(f),fillColor:"#ff0000",fontSize:12,fontWeight:"bold"}),void 0!==p&&new paper.PointText({point:[t.end.x+8,t.end.y-8],content:"".concat(p),fillColor:"#ff0000",fontSize:12,fontWeight:"bold"})}M&&Y(e,t,n||r)},X=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=new paper.Point(t.center.x,t.center.y),o=t.radius,a=t.startAngle||0,s=t.angle||90,l=a*Math.PI/180,c=l+s*Math.PI/180,d=new paper.Point(i.x+o*Math.cos(l),i.y+o*Math.sin(l)),u=new paper.Point(i.x+o*Math.cos(c),i.y+o*Math.sin(c)),f=l+s*Math.PI/360,p=new paper.Point(i.x+o*Math.cos(f),i.y+o*Math.sin(f)),h=new paper.Path.Arc({from:d,through:p,to:u});n?(h.strokeColor="#0073aa",h.strokeWidth=3):r?(h.strokeColor="#0073aa",h.strokeWidth=2):(h.strokeColor="#000",h.strokeWidth=2),h.data={elementId:t.id,type:"arc"}},K=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if("fillet"===t.type){var o,a,s=n?"#0073aa":"#000",l=n?3:2,c=t.arc;if(fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1078",message:"drawFillet checking saved points",data:{hasArcStartPoint:!!t.arcStartPoint,hasArcEndPoint:!!t.arcEndPoint,arcStartPoint:t.arcStartPoint,arcEndPoint:t.arcEndPoint},timestamp:Date.now(),sessionId:"debug-session",runId:"debug",hypothesisId:"E"})}).catch(function(){}),t.arcStartPoint&&t.arcEndPoint)o=new paper.Point(t.arcStartPoint.x,t.arcStartPoint.y),a=new paper.Point(t.arcEndPoint.x,t.arcEndPoint.y),fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1081",message:"drawFillet using saved points",data:{startPoint:{x:o.x,y:o.y},endPoint:{x:a.x,y:a.y}},timestamp:Date.now(),sessionId:"debug-session",runId:"debug",hypothesisId:"E"})}).catch(function(){});else{var d=c.startAngle*Math.PI/180,u=d+c.angle*Math.PI/180;o=new paper.Point(c.center.x+c.radius*Math.cos(d),c.center.y+c.radius*Math.sin(d)),a=new paper.Point(c.center.x+c.radius*Math.cos(u),c.center.y+c.radius*Math.sin(u)),fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1094",message:"drawFillet using calculated points",data:{startPoint:{x:o.x,y:o.y},endPoint:{x:a.x,y:a.y}},timestamp:Date.now(),sessionId:"debug-session",runId:"debug",hypothesisId:"E"})}).catch(function(){})}var f=r.find(function(e){return e.id===t.line1Id}),p=r.find(function(e){return e.id===t.line2Id});if(f&&p){var h=f.end,y=f.start,m=p.end,v=p.start,g=o.getDistance(new paper.Point(h.x,h.y)),b=o.getDistance(new paper.Point(y.x,y.y)),x=a.getDistance(new paper.Point(m.x,m.y)),w=a.getDistance(new paper.Point(v.x,v.y));fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:890",message:"drawFillet arc vs line points",data:{arcStartPoint:{x:o.x,y:o.y},arcEndPoint:{x:a.x,y:a.y},line1:{start:y,end:h},line2:{start:v,end:m},distStartToLine1End:g,distStartToLine1Start:b,distEndToLine2End:x,distEndToLine2Start:w,expectedArcStartPoint:t.arcStartPoint,expectedArcEndPoint:t.arcEndPoint},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"C"})}).catch(function(){})}var S=new paper.Point(c.center.x,c.center.y),P=Math.atan2(o.y-S.y,o.x-S.x),I=Math.atan2(a.y-S.y,a.x-S.x)-P;I>Math.PI?I-=2*Math.PI:I<-Math.PI&&(I+=2*Math.PI);var T=new paper.Path;T.add(o);for(var j=Math.max(8,Math.ceil(180*Math.abs(I)/Math.PI/5)),O=1;O<j;O++){var C=P+O/j*I,k=new paper.Point(S.x+c.radius*Math.cos(C),S.y+c.radius*Math.sin(C));T.add(k)}if(T.add(a),T.strokeColor=s,T.strokeWidth=l,T.data={elementId:t.id,type:"fillet-arc"},i&&f&&p){var A=o.getDistance(new paper.Point(f.end.x,f.end.y)),N=o.getDistance(new paper.Point(f.start.x,f.start.y)),D=a.getDistance(new paper.Point(p.end.x,p.end.y)),L=a.getDistance(new paper.Point(p.start.x,p.start.y)),F=A<N?"end":"start",z="".concat(f.id,":").concat(F),R=i.get(z),W=D<L?"end":"start",J="".concat(p.id,":").concat(W),V=i.get(J);void 0!==R&&new paper.PointText({point:[o.x+8,o.y-8],content:"A".concat(R),fillColor:"#00ff00",fontSize:12,fontWeight:"bold"}),void 0!==V&&new paper.PointText({point:[a.x+8,a.y-8],content:"A".concat(V),fillColor:"#00ff00",fontSize:12,fontWeight:"bold"})}M&&c.center&&te(e,t,n,c.center,c.radius)}},Y=function(e,t,n){if("line"===t.type){var r=(t.start.x+t.end.x)/2,i=(t.start.y+t.end.y)/2,o=45*Math.PI/180,a=r,s=i,l=r+15*Math.cos(o),c=i-15*Math.sin(o),d=l,u=c,f=l+40,p=c,h=u-3,y=x(t.length||v(t.start,t.end)),m=n?"#0073aa":"#999",g=(Math.abs(t.start.x-t.end.x),new paper.Path.Line({from:[a,s],to:[l,c],strokeColor:m,strokeWidth:.5}),new paper.Path.Line({from:[d,u],to:[f,p],strokeColor:m,strokeWidth:.5}),new paper.PointText({point:[0,0],content:y,fillColor:m,fontSize:11})),b=g.bounds.width;g.remove();var E=f-b;new paper.PointText({point:[E,h],content:y,fillColor:m,fontSize:11})}},te=function(e,t,n,r,i){if("fillet"===t.type){var o=45*Math.PI/180,a=t.arc,s=(a.startAngle+a.angle/2)*Math.PI/180,l=r.x+Math.cos(s)*i,c=r.y+Math.sin(s)*i,d=l+20*Math.cos(o),u=c-20*Math.sin(o),f=d,p=u,h=d+40,y=u,m=p-3,v="R "+x(i),g=n?"#0073aa":"#999",b=(new paper.Path.Line({from:[l,c],to:[d,u],strokeColor:g,strokeWidth:.5}),new paper.Path.Line({from:[f,p],to:[h,y],strokeColor:g,strokeWidth:.5}),new paper.PointText({point:[0,0],content:v,fillColor:g,fontSize:11})),E=b.bounds.width;b.remove();var w=h-E;new paper.PointText({point:[w,m],content:v,fillColor:g,fontSize:11})}},ne=function(e,t){var n=D.getState(),r=n.elements.find(function(t){return t.id===e.id}),i=n.elements.find(function(e){return e.id===t.id});if(r&&i&&"line"===r.type&&"line"===i.type){var o=r.id<i.id?r:i,a=r.id<i.id?i:r;fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1142",message:"createFilletAtCorner entry with actual lines",data:{line1:{id:o.id,start:o.start,end:o.end},line2:{id:a.id,start:a.start,end:a.end}},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"C"})}).catch(function(){});var s=T(o,a,10);if(s){fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:976",message:"connection found",data:{connection:s,line1End:s.line1End,line2End:s.line2End},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"A"})}).catch(function(){});var l=g(5),c=v(s,o.start),d=v(s,o.end),u=v(s,a.start),f=v(s,a.end);fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:985",message:"distances calculated",data:{distToLine1Start:c,distToLine1End:d,distToLine2Start:u,distToLine2End:f,line1EndCloser:d<c,line2EndCloser:f<u},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"D"})}).catch(function(){});var p=I(o),h=I(a),y=d<c?{x:-p.x,y:-p.y}:p,m=f<u?{x:-h.x,y:-h.y}:h,b={x:s.x+y.x*l,y:s.y+y.y*l},x={x:s.x+m.x*l,y:s.y+m.y*l},E=y,w=m,S=Math.atan2(E.y,E.x)*(180/Math.PI),P=Math.atan2(w.y,w.x)*(180/Math.PI);fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:993",message:"directions calculated",data:{dir1:E,dir2:w,line1Dir:p,line2Dir:h,line1DirToFar:y,line2DirToFar:m,arcStartPoint:b,arcEndPoint:x},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"A"})}).catch(function(){}),fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1004",message:"arc points calculated",data:{arcStartPoint:b,arcEndPoint:x,arcRadius:l,angle1:S,angle2:P},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"B"})}).catch(function(){});var j=Math.abs(P-S);j>180&&(j=360-j);var O,C=j*Math.PI/180,M={x:-E.y,y:E.x},k={x:-w.y,y:w.x},A=E.x+w.x,N=E.y+w.y,L=Math.sqrt(A*A+N*N),F=L>1e-4?{x:A/L,y:N/L}:{x:-E.y,y:E.x},R=M.x*F.x+M.y*F.y>0?M:{x:-M.x,y:-M.y},J=k.x*F.x+k.y*F.y>0?k:{x:-k.x,y:-k.y},q=x.x-b.x,B=x.y-b.y,U=R.x*J.y-R.y*J.x;if(Math.abs(U)<1e-4){var _=C>1e-4?l/Math.sin(C/2):l;O={x:s.x+F.x*_,y:s.y+F.y*_}}else{var G=(q*J.y-B*J.x)/U;O={x:b.x+G*R.x,y:b.y+G*R.y}}fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1230",message:"arc center calculation",data:{angle1:S,angle2:P,angleDiff:j,angleDiffRad:C,arcCenter:O,arcRadius:l,connection:s,dir1:E,dir2:w,perp1Dir:M,perp2Dir:k,finalPerp1Dir:R,finalPerp2Dir:J,arcStartPoint:b,arcEndPoint:x,distFromCenterToStart:v(O,b),distFromCenterToEnd:v(O,x)},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"A"})}).catch(function(){});var H=Math.atan2(b.y-O.y,b.x-O.x),$=Math.atan2(x.y-O.y,x.x-O.x)-H;$>Math.PI?$-=2*Math.PI:$<-Math.PI&&($+=2*Math.PI);var X=H*(180/Math.PI);X>180&&(X-=360),X<-180&&(X+=360);var K=Math.abs($)*(180/Math.PI),Y=b,Z=x,ee=o.length||v(o.start,o.end),te=a.length||v(a.start,a.end),ne=Y,re=Z,ie=v(ne,o.end),oe=v(ne,o.start),ae=ie+.01<oe,se=v(re,a.end),le=v(re,a.start),ce=se+.01<le,de=ae?{end:ne,length:ee}:{start:ne,length:ee},ue=ce?{end:re,length:te}:{start:re,length:te};fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1234",message:"before updateElement",data:{line1Id:o.id,line1:{start:o.start,end:o.end},line1Update:de,line2Id:a.id,line2:{start:a.start,end:a.end},line2Update:ue,arcStartPoint:Y,arcEndPoint:Z,originalArcStartPoint:b,originalArcEndPoint:x,line1EndTruncated:ae,line2EndTruncated:ce,distArcPoint1ToLine1End:ie,distArcPoint1ToLine1Start:oe,distArcPoint2ToLine2End:se,distArcPoint2ToLine2Start:le,distToLine1Start:c,distToLine1End:d,distToLine2Start:u,distToLine2End:f,connection:s,dir1:E,dir2:w,arcCenter:O},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"A"})}).catch(function(){}),V(o.id,de),V(a.id,ue);var fe=D.getState(),pe=fe.elements.find(function(e){return e.id===o.id}),he=fe.elements.find(function(e){return e.id===a.id});fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1254",message:"after updateElement",data:{line1After:{start:null==pe?void 0:pe.start,end:null==pe?void 0:pe.end},line2After:{start:null==he?void 0:he.start,end:null==he?void 0:he.end},arcStartPoint:Y,arcEndPoint:Z,expectedLine1End:ae?Y:o.end,expectedLine2Start:ce?a.start:Z},timestamp:Date.now(),sessionId:"debug-session",runId:"initial",hypothesisId:"B"})}).catch(function(){});var ye={type:"fillet",radius:l,line1Id:o.id,line2Id:a.id,arc:{center:O,radius:l,startAngle:X,angle:K},arcStartPoint:ne,arcEndPoint:re,connection:s,line1Direction:E,line2Direction:w,angle1:S,angle2:P,line1EndTruncated:ae,line2EndTruncated:ce};fetch("http://127.0.0.1:7242/ingest/49b89e88-4674-4191-9133-bf7fd16c00a5",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"CanvasEditor.jsx:1088",message:"fillet created",data:{fillet:Q(Q({},ye),{},{arc:Q({},ye.arc)})},timestamp:Date.now(),sessionId:"debug-session",runId:"post-fix",hypothesisId:"C"})}).catch(function(){}),z(ye),W(null)}}};return i().createElement("div",{ref:t,className:"canvas-editor"},i().createElement("canvas",{ref:e,id:"plintus-paperjs-canvas",style:{width:"100%",height:"100%",display:"block"}}))};var ie=n(925),oe={};oe.styleTagTransform=G(),oe.setAttributes=q(),oe.insert=J().bind(null,"head"),oe.domAPI=R(),oe.insertStyleElement=U(),F()(ie.A,oe),ie.A&&ie.A.locals&&ie.A.locals;const ae=function(e){var t=e.tool,n=e.isActive,r=e.onClick;return i().createElement("button",{type:"button",className:"plintus-tool-button ".concat(n?"active":""),onClick:r,title:t.label},i().createElement("i",{className:"fs-28 uil ".concat(t.icon)}))},se=function(){var e=D(),t=e.selectedTool,n=e.setSelectedTool,r=e.grid,o=e.toggleMajorLines,a=e.dimensionsVisible,s=e.toggleDimensionsVisible,l=e.orthogonalSnap,c=e.toggleOrthogonalSnap;return i().createElement("div",{className:"plintus-toolbar"},i().createElement("div",{className:"plintus-toolbar-section"},[{id:"line",label:"Рисование",icon:"uil-edit-alt"},{id:"select",label:"Редактировать",icon:"uil-vector-square"},{id:"arc",label:"Радиус",icon:"uil-circle"},{id:"delete",label:"Удаление",icon:"uil-trash-alt"}].map(function(e){return i().createElement(ae,{key:e.id,tool:e,isActive:t===e.id,onClick:function(){return n(e.id)}})})),i().createElement("div",{className:"plintus-toolbar-section plintus-toolbar-section-right"},i().createElement("button",{type:"button",onClick:function(e){e.preventDefault(),e.stopPropagation(),c()},className:l?"active":"",title:"Toggle Orthogonal Snap"},i().createElement("i",{className:"fs-28 uil uil-vector-square-alt"})),i().createElement("button",{type:"button",onClick:function(e){e.preventDefault(),e.stopPropagation(),o()},className:r.showMajorLines?"active":"",title:"Show/Hide Major Grid Lines (10mm)"},i().createElement("i",{className:"fs-28 uil uil-grids"})),i().createElement("button",{type:"button",onClick:function(e){e.preventDefault(),e.stopPropagation(),s()},className:a?"active":"",title:"Show/Hide Dimensions"},i().createElement("i",{className:"fs-28 uil uil-ruler"}))))};var le=n(47),ce={};ce.styleTagTransform=G(),ce.setAttributes=q(),ce.insert=J().bind(null,"head"),ce.domAPI=R(),ce.insertStyleElement=U(),F()(le.A,ce),le.A&&le.A.locals&&le.A.locals;const de=function(){var e=D(),t=e.selectedTool,n=e.setSelectedTool;return i().createElement("div",{className:"plintus-vertical-toolbar"},[{id:"line",label:"Рисование",icon:"uil-edit-alt"},{id:"select",label:"Редактировать",icon:"uil-vector-square"},{id:"arc",label:"Радиус",icon:"uil-circle"},{id:"delete",label:"Удаление",icon:"uil-trash-alt"}].map(function(e){return i().createElement("button",{key:e.id,type:"button",className:"plintus-vertical-tool-button ".concat(t===e.id?"active":""),onClick:function(){return n(e.id)},title:e.label},i().createElement("i",{className:"fs-28 uil ".concat(e.icon)}),i().createElement("span",{className:"plintus-vertical-tool-button-text"},e.label))}))},ue=function(e){var t=e.elements,n=x(t.reduce(function(e,t){return t.start&&t.end?e+v(t.start,t.end):t.length?e+t.length:e},0));return i().createElement("div",{className:"line-properties"},i().createElement("h4",null,"Line Properties"),t.length>1&&i().createElement("p",{className:"line-count"},"Lines: ",t.length),i().createElement("div",{className:"property-item"},i().createElement("label",null,"Length:"),i().createElement("span",{className:"property-value"},n)))};function fe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return pe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const he=function(e){var t=e.element,n=D().updateElement,o=fe((0,r.useState)(t.radius?Math.round(b(t.radius)):5),2),a=o[0],s=o[1],l=fe((0,r.useState)(t.angle?Math.round(t.angle):90),2),c=l[0],d=l[1];(0,r.useEffect)(function(){if(t.radius){var e=Math.round(b(t.radius));s(e)}void 0!==t.angle&&d(Math.round(t.angle))},[t.radius,t.angle]);var u=x((t.radius||0)*(c*Math.PI/180));return i().createElement("div",{className:"arc-properties"},i().createElement("h4",null,"Arc Properties"),i().createElement("div",{className:"property-item"},i().createElement("label",{htmlFor:"arc-radius"},"Radius (mm):"),i().createElement("input",{id:"arc-radius",type:"number",min:"1",step:"1",value:a,onChange:function(e){var r=parseFloat(e.target.value);!isNaN(r)&&r>0&&(s(r),n(t.id,{radius:g(r)}))},className:"property-input"})),i().createElement("div",{className:"property-item"},i().createElement("label",{htmlFor:"arc-angle"},"Angle (°):"),i().createElement("input",{id:"arc-angle",type:"number",min:"0",max:"360",step:"1",value:c,onChange:function(e){var r=parseFloat(e.target.value);!isNaN(r)&&r>=0&&r<=360&&(d(r),n(t.id,{angle:r}))},className:"property-input"})),i().createElement("div",{className:"property-item"},i().createElement("label",null,"Length:"),i().createElement("span",{className:"property-value"},u)))};function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}const me=function(e){var t,n,o=e.element,a=D().updateFilletRadius,s=(t=(0,r.useState)(o.radius?Math.round(b(o.radius)):5),n=2,function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,n)||function(e,t){if(e){if("string"==typeof e)return ye(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ye(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),l=s[0],c=s[1];return(0,r.useEffect)(function(){if(o.radius){var e=Math.round(b(o.radius));c(e)}},[o.radius]),i().createElement("div",{className:"fillet-properties"},i().createElement("h4",null,"Fillet Properties"),i().createElement("div",{className:"property-item"},i().createElement("label",{htmlFor:"fillet-radius"},"Radius (mm):"),i().createElement("input",{id:"fillet-radius",type:"number",min:"1",step:"1",value:l,onChange:function(e){var t=parseFloat(e.target.value);!isNaN(t)&&t>0&&(c(t),a(o.id,t))},className:"property-input"})))};var ve=n(38),ge={};ge.styleTagTransform=G(),ge.setAttributes=q(),ge.insert=J().bind(null,"head"),ge.domAPI=R(),ge.insertStyleElement=U(),F()(ve.A,ge),ve.A&&ve.A.locals&&ve.A.locals;const be=function(e){var t=e.elements,n=D().deleteSelectedElements,r=D(function(e){return e.elements}),o=t.filter(function(e){return"line"===e.type}),a=t.filter(function(e){return"arc"===e.type}),s=t.filter(function(e){return"fillet"===e.type}),l=function(e){return"line"===e.type?e.start&&e.end?v(e.start,e.end):e.length?e.length:0:"arc"===e.type?(e.radius||0)*((e.angle||90)*Math.PI/180):"fillet"===e.type?(e.arc&&e.arc.radius||e.radius||0)*((e.arc&&e.arc.angle||0)*Math.PI/180):0},c=r.filter(function(e){return"line"===e.type}),d=r.filter(function(e){return"fillet"===e.type}),u=x(c.reduce(function(e,t){return e+l(t)},0)),f=d.length;return i().createElement("div",{className:"plintus-properties-panel"},i().createElement("div",{className:"panel-header"},t.length>0&&i().createElement("button",{onClick:function(){n()},className:"delete-button"},"Delete")),i().createElement("div",{className:"panel-content"},i().createElement("div",{className:"properties-summary"},i().createElement("h4",null,"Summary"),i().createElement("div",{className:"summary-item"},i().createElement("span",{className:"summary-label"},"Total Lines Length:"),i().createElement("span",{className:"summary-value"},u)),i().createElement("div",{className:"summary-item"},i().createElement("span",{className:"summary-label"},"Fillets Count:"),i().createElement("span",{className:"summary-value"},f))),i().createElement("div",{className:"properties-section"},i().createElement("h3",{className:"properties-section-title"},0===t.length?"Properties":"Properties (".concat(t.length," selected)"))),i().createElement("div",{className:"properties-elements-list"},i().createElement("h4",null,"Selected Elements:"),t.length>0?i().createElement("ul",{className:"properties-elements-list-items"},t.map(function(e,t){var n=x(l(e));return i().createElement("li",{key:e.id,className:"properties-element-item"},i().createElement("span",{className:"element-type-badge"},e.type),i().createElement("span",{className:"element-id"},"#",t+1),i().createElement("span",{className:"element-length"},n))})):i().createElement("p",{className:"properties-empty-state"},"No elements selected")),o.length>0&&i().createElement(ue,{elements:o}),1===a.length&&i().createElement(he,{element:a[0]}),1===s.length&&i().createElement(me,{element:s[0]})))};var xe,Ee;function we(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function o(n,r,i,o){var l=r&&r.prototype instanceof s?r:s,c=Object.create(l.prototype);return Se(c,"_invoke",function(n,r,i){var o,s,l,c=0,d=i||[],u=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return o=t,s=0,l=e,f.n=n,a}};function p(n,r){for(s=n,l=r,t=0;!u&&c&&!i&&t<d.length;t++){var i,o=d[t],p=f.p,h=o[2];n>3?(i=h===r)&&(l=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=p&&((i=n<2&&p<o[1])?(s=0,f.v=r,f.n=o[1]):p<h&&(i=n<3||o[0]>r||r>h)&&(o[4]=n,o[5]=r,f.n=h,s=0))}if(i||n>1)return a;throw u=!0,r}return function(i,d,h){if(c>1)throw TypeError("Generator is already running");for(u&&1===d&&p(d,h),s=d,l=h;(t=s<2?e:l)||!u;){o||(s?s<3?(s>1&&(f.n=-1),p(s,l)):f.n=l:f.v=l);try{if(c=2,o){if(s||(i="next"),t=o[i]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0)}else 1===s&&(t=o.return)&&t.call(o),s<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),s=1);o=e}else if((t=(u=f.n<0)?l:n.call(r,f))!==a)break}catch(t){o=e,s=1,l=t}finally{c=1}}return{value:t,done:u}}}(n,i,o),!0),c}var a={};function s(){}function l(){}function c(){}t=Object.getPrototypeOf;var d=[][r]?t(t([][r]())):(Se(t={},r,function(){return this}),t),u=c.prototype=s.prototype=Object.create(d);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,c):(e.__proto__=c,Se(e,i,"GeneratorFunction")),e.prototype=Object.create(u),e}return l.prototype=c,Se(u,"constructor",c),Se(c,"constructor",l),l.displayName="GeneratorFunction",Se(c,i,"GeneratorFunction"),Se(u),Se(u,i,"Generator"),Se(u,r,function(){return this}),Se(u,"toString",function(){return"[object Generator]"}),(we=function(){return{w:o,m:f}})()}function Se(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}Se=function(e,t,n,r){function o(t,n){Se(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},Se(e,t,n,r)}function Pe(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function Ie(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function a(e){Pe(o,r,i,a,s,"next",e)}function s(e){Pe(o,r,i,a,s,"throw",e)}a(void 0)})}}var Te=(null===(xe=window.plintusEditor)||void 0===xe?void 0:xe.apiUrl)||"/wp-json/plintus-paperjs/v1/",je=(null===(Ee=window.plintusEditor)||void 0===Ee?void 0:Ee.nonce)||"";function Oe(){return(Oe=Ie(we().m(function e(t){var n,r;return we().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(Te,"profiles/").concat(t,"/data"),{method:"GET",headers:{"X-WP-Nonce":je}});case 1:if((n=e.v).ok){e.n=2;break}throw new Error("Failed to load profile data");case 2:return e.n=3,n.json();case 3:return e.a(2,e.v);case 4:return e.p=4,r=e.v,console.error("Error loading profile data:",r),e.a(2,null)}},e,null,[[0,4]])}))).apply(this,arguments)}function Ce(){return(Ce=Ie(we().m(function e(t,n){var r,i;return we().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(Te,"profiles/").concat(t,"/data"),{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":je},body:JSON.stringify({data:n})});case 1:if((r=e.v).ok){e.n=2;break}throw new Error("Failed to save profile data");case 2:return e.n=3,r.json();case 3:return e.a(2,e.v);case 4:return e.p=4,i=e.v,console.error("Error saving profile data:",i),e.a(2,null)}},e,null,[[0,4]])}))).apply(this,arguments)}var Me=n(912),ke={};ke.styleTagTransform=G(),ke.setAttributes=q(),ke.insert=J().bind(null,"head"),ke.domAPI=R(),ke.insertStyleElement=U(),F()(Me.A,ke),Me.A&&Me.A.locals&&Me.A.locals;const Ae=function(){var e,t=D(),n=t.selectedElements,o=t.loadProfile,a=null===(e=window.plintusEditor)||void 0===e?void 0:e.profileId;return(0,r.useEffect)(function(){a&&function(e){return Oe.apply(this,arguments)}(a).then(function(e){e&&e.data&&o(e.data)})},[a,o]),(0,r.useEffect)(function(){var e=setInterval(function(){var e=D.getState(),t=e.elements,n=e.grid,r=e.viewbox;a&&t.length>=0&&function(e,t){Ce.apply(this,arguments)}(a,{elements:t,grid:n,viewbox:r})},5e3);return function(){return clearInterval(e)}},[a]),i().createElement("div",{className:"plintus-editor"},i().createElement(se,null),i().createElement("div",{className:"plintus-editor-content"},i().createElement(de,null),i().createElement("div",{className:"plintus-editor-canvas-wrapper"},i().createElement(re,null)),i().createElement(be,{elements:n})))};var Ne=document.getElementById("plintus-profile-editor-paperjs-root");if(Ne)try{o.createRoot(Ne).render(i().createElement(Ae,null))}catch(e){console.error("Error rendering React app:",e)}})();